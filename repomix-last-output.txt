This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching these patterns are excluded: repomix-output*, json, repomix-last-output.txt
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
backend/
  .mvn/
    wrapper/
      maven-wrapper.properties
  src/
    main/
      java/
        pe/
          ezer/
            backend/
              config/
                security/
                  JwtFilter.java
                  JwtUtil.java
                seeder/
                  NoteDataSeeder.java
                  UserDataSeeder.java
                WebSecurityConfig.java
              modules/
                note/
                  domain/
                    Note.java
                    Tag.java
                  mapper/
                    NoteMapper.java
                    TagMapper.java
                  repo/
                    NoteRepository.java
                    TagRepository.java
                  service/
                    NoteService.java
                    TagService.java
                  web/
                    dto/
                      NoteRequest.java
                      NoteResponse.java
                      TagRequest.java
                      TagResponse.java
                    NoteRestController.java
                    TagRestController.java
                user/
                  domain/
                    User.java
                  mapper/
                    UserMapper.java
                  repo/
                    UserRepository.java
                  service/
                    UserService.java
                  web/
                    dto/
                      AuthRequest.java
                      UserRequest.java
                      UserResponse.java
                    AuthRestController.java
                    UserRestController.java
              BackendApplication.java
      resources/
        application.properties
    test/
      java/
        pe/
          ezer/
            backend/
              BackendApplicationTests.java
  .gitattributes
  .gitignore
  mvnw
  mvnw.cmd
  pom.xml
frontend/
  .vscode/
    extensions.json
    launch.json
    tasks.json
  public/
    favicon.ico
  src/
    app/
      core/
        guards/
          auth.guard.ts
        interceptors/
          auth.interceptor.ts
      features/
        auth/
          models/
            login-request.ts
            login-response.ts
          pages/
            login/
              login.component.css
              login.component.html
              login.component.spec.ts
              login.component.ts
          services/
            auth.service.ts
          auth.routes.ts
        notes/
          components/
            note-card/
              note-card.component.css
              note-card.component.html
              note-card.component.spec.ts
              note-card.component.ts
            note-form/
              note-form.component.css
              note-form.component.html
              note-form.component.spec.ts
              note-form.component.ts
          models/
            note-request.ts
            note-response.ts
            tag-request.ts
            tag-response.ts
          pages/
            notes-list/
              notes-list.component.css
              notes-list.component.html
              notes-list.component.spec.ts
              notes-list.component.ts
            tags-list/
              tags-list.component.css
              tags-list.component.html
              tags-list.component.spec.ts
              tags-list.component.ts
          services/
            notes.service.ts
            tags.service.ts
          notes.routes.ts
          tags.routes.ts
      app.component.css
      app.component.html
      app.component.spec.ts
      app.component.ts
      app.config.ts
      app.routes.ts
    index.html
    main.ts
    styles.css
  .editorconfig
  .gitignore
  angular.json
  package.json
  README.md
  tsconfig.app.json
  tsconfig.json
  tsconfig.spec.json
CHALLENGE.md
Readme.md
run.ps1
run.sh
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="backend/.mvn/wrapper/maven-wrapper.properties">
wrapperVersion=3.3.4
distributionType=only-script
distributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.11/apache-maven-3.9.11-bin.zip
</file>

<file path="backend/src/main/java/pe/ezer/backend/config/security/JwtFilter.java">
package pe.ezer.backend.config.security;

import java.io.IOException;
import java.util.Collections;

import org.springframework.lang.NonNull;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;

@Component
@RequiredArgsConstructor
public class JwtFilter extends OncePerRequestFilter {
    private final JwtUtil jwtUtil;

    @Override
    protected void doFilterInternal(@NonNull HttpServletRequest request, @NonNull HttpServletResponse response, @NonNull FilterChain filterChain)
            throws IOException, ServletException {
        String authHeader = request.getHeader("Authorization");
        String username = null;
        String token = null;

        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            token = authHeader.substring(7);
            if (jwtUtil.validateToken(token)) {
                username = jwtUtil.extractUsername(token);
            }
        }

        if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {
            if (jwtUtil.validateToken(token)) {
                UsernamePasswordAuthenticationToken authToken = new UsernamePasswordAuthenticationToken(username, null,
                        Collections.emptyList());
                authToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                SecurityContextHolder.getContext().setAuthentication(authToken);
            }
        }
        filterChain.doFilter(request, response);
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/config/security/JwtUtil.java">
package pe.ezer.backend.config.security;

import java.nio.charset.StandardCharsets;
import java.util.Date;

import javax.crypto.SecretKey;

import org.springframework.stereotype.Component;

import io.jsonwebtoken.JwtException;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.security.Keys;

@Component
public class JwtUtil {
    private static final String SECRET = "mySecretKey123456789012345678901234567890";
    private static final long EXPIRATION_TIME = 1000 * 60 * 60;
    private static final SecretKey KEY = Keys.hmacShaKeyFor(SECRET.getBytes(StandardCharsets.UTF_8));

    public String generateToken(String username) {
        return Jwts.builder()
                .subject(username)
                .issuedAt(new Date())
                .expiration(new Date(System.currentTimeMillis() + EXPIRATION_TIME))
                .signWith(KEY)
                .compact();
    }

    public String extractUsername(String token) {
        return Jwts.parser().verifyWith(KEY).build().parseSignedClaims(token).getPayload().getSubject();
    }

    public boolean validateToken(String token) {
        try {
            Jwts.parser().verifyWith(KEY).build().parseSignedClaims(token);
            return true;
        } catch (JwtException e) {
            return false;
        }
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/config/seeder/NoteDataSeeder.java">
package pe.ezer.backend.config.seeder;

import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

import lombok.RequiredArgsConstructor;
import pe.ezer.backend.modules.note.domain.Note;
import pe.ezer.backend.modules.note.service.NoteService;
import pe.ezer.backend.modules.user.domain.User;

@Component
@RequiredArgsConstructor
@Order(2)
public class NoteDataSeeder implements CommandLineRunner {

    private final NoteService noteSeeder;

    @Override
    public void run(String... args) throws Exception {
        noteSeeder();
    }

    private void noteSeeder() {
        // User1
        User user1 = User.builder().id(1L).build();
        if (noteSeeder.getNotesByUserId(1L).size() < 4) {
            Note note1 = Note.builder()
                    .title("First Note")
                    .content("This is the content of the first note.")
                    .user(user1)
                    .archived(true)
                    .build();
            if (note1 != null)
                noteSeeder.createNote(note1);
            Note note2 = Note.builder()
                    .title("Second Note")
                    .content("This is the content of the second note.")
                    .user(user1)
                    .archived(false)
                    .build();
            if (note2 != null)
                noteSeeder.createNote(note2);
            Note note3 = Note.builder()
                    .title("Third Note")
                    .content("This is the content of the third note.")
                    .user(user1)
                    .archived(false)
                    .build();
            if (note3 != null)
                noteSeeder.createNote(note3);
        }

        // User2
        User user2 = User.builder().id(2L).build();
        if (noteSeeder.getNotesByUserId(2L).size() < 4) {
            Note note4 = Note.builder()
                    .title("Fourth Note")
                    .content("This is the content of the fourth note.")
                    .user(user2)
                    .archived(false)
                    .build();
            if (note4 != null)
                noteSeeder.createNote(note4);

            Note note5 = Note.builder()
                    .title("Fifth Note")
                    .content("This is the content of the fifth note.")
                    .user(user2)
                    .archived(true)
                    .build();
            if (note5 != null)
                noteSeeder.createNote(note5);

            Note note6 = Note.builder()
                    .title("Sixth Note")
                    .content("This is the content of the sixth note.")
                    .user(user2)
                    .archived(true)
                    .build();
            if (note6 != null)
                noteSeeder.createNote(note6);
        }
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/config/seeder/UserDataSeeder.java">
package pe.ezer.backend.config.seeder;

import java.util.Optional;

import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

import lombok.RequiredArgsConstructor;
import pe.ezer.backend.modules.user.domain.User;
import pe.ezer.backend.modules.user.service.UserService;

@Component
@RequiredArgsConstructor
@Order(1)
public class UserDataSeeder implements CommandLineRunner {

    private final UserService userService;

    @Override
    public void run(String... args) throws Exception {
        seedUser();
    }

    private void seedUser() {
        Optional<User> user1 = userService.findByUsername("admin");
        if (user1.isEmpty()) {
            User user = User.builder()
                    .username("admin")
                    .password("admin123")
                    .build();
            if (user != null) userService.save(user);
        }
        Optional<User> user2 = userService.findByUsername("user");
        if (user2.isEmpty()) {
            User user = User.builder()
                    .username("user")
                    .password("user123")
                    .build();
            if (user != null) userService.save(user);
        }

        Optional<User> user3 = userService.findByUsername("guest");
        if (user3.isEmpty()) {
            User user = User.builder()
                    .username("guest")
                    .password("guest123")
                    .build();
            if (user != null) userService.save(user);
        }
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/config/WebSecurityConfig.java">
package pe.ezer.backend.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import java.util.Arrays;

import lombok.RequiredArgsConstructor;
import pe.ezer.backend.config.security.JwtFilter;

@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class WebSecurityConfig {

    private final JwtFilter jwtFilter;

    @Bean
    SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -> csrf.disable())
                .cors(cors -> cors.configurationSource(corsConfigurationSource()))
                .authorizeHttpRequests(auth -> auth.requestMatchers("/auth/**").permitAll().anyRequest().authenticated())
                .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS));
        http.addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class);
        return http.build();
    }

    @Bean
    CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Arrays.asList("http://localhost:4200"));
        configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
        configuration.setAllowedHeaders(Arrays.asList("*"));
        configuration.setAllowCredentials(true);
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);
        return source;
    }

    @Bean
    PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/domain/Note.java">
package pe.ezer.backend.modules.note.domain;

import java.time.LocalDateTime;
import java.util.HashSet;
import java.util.Set;

import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.FetchType;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.JoinTable;
import jakarta.persistence.ManyToMany;
import jakarta.persistence.ManyToOne;
import jakarta.persistence.Table;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import pe.ezer.backend.modules.user.domain.User;

@Entity
@Table(name = "notes")
@Data
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class Note {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "title", nullable = false)
    private String title;

    @Column(name = "content")
    private String content;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User user;

    @Column(name = "archived", nullable = false)
    @Builder.Default
    private Boolean archived = false;

    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(name = "note_tags", joinColumns = @JoinColumn(name = "note_id"), inverseJoinColumns = @JoinColumn(name = "tag_id"))
    @Builder.Default
    @lombok.EqualsAndHashCode.Exclude
    @lombok.ToString.Exclude
    private Set<Tag> tags = new HashSet<>();

    @CreationTimestamp
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @UpdateTimestamp
    @Column(name = "updated_at")
    private LocalDateTime updatedAt;
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/domain/Tag.java">
package pe.ezer.backend.modules.note.domain;

import java.time.LocalDateTime;
import java.util.HashSet;
import java.util.Set;

import org.hibernate.annotations.CreationTimestamp;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.ManyToMany;
import jakarta.persistence.Table;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(name = "tags")
@Data
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class Tag {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true)
    private String name;

    @ManyToMany(mappedBy = "tags")
    @Builder.Default
    @lombok.EqualsAndHashCode.Exclude
    @lombok.ToString.Exclude
    private Set<Note> notes = new HashSet<>();

    @CreationTimestamp
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/mapper/NoteMapper.java">
package pe.ezer.backend.modules.note.mapper;

import pe.ezer.backend.modules.note.domain.Note;
import pe.ezer.backend.modules.note.domain.Tag;
import pe.ezer.backend.modules.note.web.dto.NoteRequest;
import pe.ezer.backend.modules.note.web.dto.NoteResponse;

public final class NoteMapper {
    
    public static Note toEntity(NoteRequest request) {
        if (request == null) {
            return null;
        }
        Note note = new Note();
        note.setTitle(request.title());
        note.setContent(request.content());
        return note;
    }

    public static NoteResponse toResponse(Note note) {
        if (note == null) {
            return null;
        }
        
        var tags = note.getTags() != null ? note.getTags() : new java.util.HashSet<Tag>();
        
        return new NoteResponse(
            note.getId(),
            note.getTitle(),
            note.getContent(),
            tags.size(),
            tags.stream().map(Tag::getName).toList(),
            note.getCreatedAt(),
            note.getUpdatedAt()
        );
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/mapper/TagMapper.java">
package pe.ezer.backend.modules.note.mapper;

import pe.ezer.backend.modules.note.domain.Tag;
import pe.ezer.backend.modules.note.web.dto.TagRequest;
import pe.ezer.backend.modules.note.web.dto.TagResponse;

public final class TagMapper {
    public static Tag toEntity(TagRequest request) {
        if (request == null) {
            return null;
        }
        Tag tag = new Tag();
        tag.setName(request.name());
        return tag;
    }

    public static TagResponse toResponse(Tag tag) {
        if (tag == null) {
            return null;
        }
        return new TagResponse(
            tag.getId(),
            tag.getName(),
            tag.getCreatedAt()
        );
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/repo/NoteRepository.java">
package pe.ezer.backend.modules.note.repo;

import java.util.List;
import java.util.Optional;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

import pe.ezer.backend.modules.note.domain.Note;

public interface NoteRepository extends JpaRepository<Note, Long> {
    @Query("""
                SELECT DISTINCT n
                FROM Note n
                LEFT JOIN FETCH n.tags
            """)
    List<Note> findAllWithTags();

    @Query("""
                SELECT DISTINCT n
                FROM Note n
                LEFT JOIN FETCH n.tags
                WHERE n.id = :id
            """)
    Optional<Note> findByIdWithTags(Long id);
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/repo/TagRepository.java">
package pe.ezer.backend.modules.note.repo;

import org.springframework.data.jpa.repository.JpaRepository;

import pe.ezer.backend.modules.note.domain.Tag;

public interface TagRepository extends JpaRepository<Tag, Long> {

}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/service/NoteService.java">
package pe.ezer.backend.modules.note.service;

import java.util.List;

import org.springframework.lang.NonNull;
import org.springframework.stereotype.Service;

import lombok.RequiredArgsConstructor;
import pe.ezer.backend.modules.note.domain.Note;
import pe.ezer.backend.modules.note.domain.Tag;
import pe.ezer.backend.modules.note.repo.NoteRepository;

@Service
@RequiredArgsConstructor
public class NoteService {
    private final NoteRepository noteRepository;
    private final TagService tagService;

    public List<Note> getAllNotes() {
        List<Note> notes = noteRepository.findAllWithTags();
        return notes;
    }

    public Note getNoteById(@NonNull Long id) {
        return noteRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Note not found with id: " + id));
    }

    public List<Note> getNotesByUserId(@NonNull Long userId) {
        return getAllNotes().stream()
                .filter(note -> note.getUser().getId().equals(userId))
                .toList();
    }

    public Note createNote(@NonNull Note note) {
        return noteRepository.save(note);
    }

    public Note updateNote(@NonNull Long id, @NonNull String title, @NonNull String content) {
        Note existingNote = noteRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Note not found with id: " + id));
        existingNote.setTitle(title);
        existingNote.setContent(content);
        return noteRepository.save(existingNote);
    }

    public Note archiveNote(@NonNull Long id) {
        Note existingNote = noteRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Note not found with id: " + id));
        existingNote.setArchived(true);
        return noteRepository.save(existingNote);
    }

    public Note unarchiveNote(@NonNull Long id) {
        Note existingNote = noteRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Note not found with id: " + id));
        existingNote.setArchived(false);
        return noteRepository.save(existingNote);
    }

    public void deleteNote(@NonNull Long id) {
        if (!noteRepository.existsById(id)) {
            throw new RuntimeException("Note not found with id: " + id);
        }
        noteRepository.deleteById(id);
    }

    public Note addTagToNote(@NonNull Long noteId, @NonNull Long tagId) {
        Note note = getNoteById(noteId);
        Tag tag = tagService.getTagById(tagId);

        note.getTags().add(tag);
        return noteRepository.save(note);
    }

    public Note removeTagFromNote(@NonNull Long noteId, @NonNull Long tagId) {
        Note note = getNoteById(noteId);
        Tag tag = tagService.getTagById(tagId);

        note.getTags().remove(tag);
        return noteRepository.save(note);
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/service/TagService.java">
package pe.ezer.backend.modules.note.service;

import java.util.List;

import org.springframework.lang.NonNull;
import org.springframework.stereotype.Service;

import lombok.RequiredArgsConstructor;
import pe.ezer.backend.modules.note.domain.Tag;
import pe.ezer.backend.modules.note.repo.TagRepository;

@Service
@RequiredArgsConstructor
public class TagService {
    private final TagRepository tagRepository;

    public List<Tag> getAllTags() {
        return tagRepository.findAll();
    }

    public Tag createTag(@NonNull Tag tag) {
        return tagRepository.save(tag);
    }

    public Tag getTagById(@NonNull Long id) {
        return tagRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Tag not found with id: " + id));
    }

    public void deleteTag(@NonNull Long id) {
        if (!tagRepository.existsById(id)) {
            throw new RuntimeException("Tag not found with id: " + id);
        }
        Tag tag = tagRepository.findById(id).orElse(null);
        if (tag != null) {
            tag.getNotes().forEach(note -> note.getTags().remove(tag));
        }
        tagRepository.deleteById(id);
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/web/dto/NoteRequest.java">
package pe.ezer.backend.modules.note.web.dto;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;

public record NoteRequest(

    @NotBlank(message = "Title is mandatory")
    @Size(max = 100, message = "Title must be at most 100 characters")
    String title,

    @NotBlank(message = "Content is mandatory")
    @Size(max = 1000, message = "Content must be at most 1000 characters")
    String content
) {}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/web/dto/NoteResponse.java">
package pe.ezer.backend.modules.note.web.dto;

import java.time.LocalDateTime;
import java.util.List;

public record NoteResponse(
    Long id,
    String title,
    String content,
    int tagsCount,
    List<String> tags,
    LocalDateTime createdAt,
    LocalDateTime updatedAt
) {}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/web/dto/TagRequest.java">
package pe.ezer.backend.modules.note.web.dto;

import jakarta.validation.constraints.NotBlank;

public record TagRequest(
    @NotBlank(message = "Tag name is required")
    String name
) {}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/web/dto/TagResponse.java">
package pe.ezer.backend.modules.note.web.dto;

import java.time.LocalDateTime;

public record TagResponse(
    Long id,
    String name,
    LocalDateTime createdAt
) {}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/web/NoteRestController.java">
package pe.ezer.backend.modules.note.web;

import java.util.List;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import pe.ezer.backend.modules.note.domain.Note;
import pe.ezer.backend.modules.note.mapper.NoteMapper;
import pe.ezer.backend.modules.note.service.NoteService;
import pe.ezer.backend.modules.note.web.dto.NoteRequest;
import pe.ezer.backend.modules.note.web.dto.NoteResponse;
import pe.ezer.backend.modules.user.domain.User;
import pe.ezer.backend.modules.user.service.UserService;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/notes")
public class NoteRestController {

    private final NoteService noteService;
    private final UserService userService;

    @GetMapping("/{id}")
    public ResponseEntity<NoteResponse> getNoteById(@PathVariable Long id) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }

        // Validate input
        if (id == null) {
            return ResponseEntity.badRequest().build();
        }
        try {
            var note = noteService.getNoteById(id);
            // Check if the note belongs to the authenticated user
            if (!note.getUser().getId().equals(user.getId())) {
                return ResponseEntity.status(HttpStatus.FORBIDDEN).build();
            }
            var noteResponse = NoteMapper.toResponse(note);
            return ResponseEntity.ok(noteResponse);
        } catch (RuntimeException e) {
            return ResponseEntity.notFound().build();
        }
    }

    @GetMapping
    public ResponseEntity<List<NoteResponse>> getAllNotes(@RequestParam(required = false) Long tagId) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }

        // Validate input
        Long userId = user.getId();
        if (userId == null) {
            return ResponseEntity.badRequest().build();
        }
        
        var notes = noteService.getNotesByUserId(userId).stream()
                .filter(note -> !note.getArchived())
                .toList();
        
        // Filter by tagId if provided
        if (tagId != null) {
            notes = notes.stream()
                    .filter(note -> note.getTags().stream()
                            .anyMatch(tag -> tag.getId().equals(tagId)))
                    .toList();
        }
        
        var noteResponses = notes.stream()
                .map(NoteMapper::toResponse)
                .toList();
        return ResponseEntity.ok(noteResponses);
    }

    @GetMapping("/archived")
    public ResponseEntity<List<NoteResponse>> getArchivedNotes(@RequestParam(required = false) Long tagId) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }

        // Validate input
        Long userId = user.getId();
        if (userId == null) {
            return ResponseEntity.badRequest().build();
        }
        var notes = noteService.getNotesByUserId(userId).stream()
                .filter(note -> note.getArchived())
                .toList();
                
        // Filter by tagId if provided
        if (tagId != null) {
            notes = notes.stream()
                    .filter(note -> note.getTags().stream()
                            .anyMatch(tag -> tag.getId().equals(tagId)))
                    .toList();
        }
        
        var noteResponses = notes.stream()
                .map(NoteMapper::toResponse)
                .toList();
        return ResponseEntity.ok(noteResponses);
    }

    @PutMapping("/{id}/archive")
    public ResponseEntity<NoteResponse> archiveNote(@PathVariable Long id) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }
        // Validate input
        if (id == null) {
            return ResponseEntity.badRequest().build();
        }
        try {
            Note existingNote = noteService.getNoteById(id);
            if (!existingNote.getUser().getId().equals(user.getId())) {
                return ResponseEntity.status(HttpStatus.FORBIDDEN).build();
            }

            Note archivedNote = noteService.archiveNote(id);
            NoteResponse response = NoteMapper.toResponse(archivedNote);

            return ResponseEntity.ok(response);
        } catch (RuntimeException e) {
            return ResponseEntity.notFound().build();
        }
    }

    @PutMapping("/{id}/unarchive")
    public ResponseEntity<NoteResponse> unarchiveNote(@PathVariable Long id) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }
        // Validate input
        if (id == null) {
            return ResponseEntity.badRequest().build();
        }
        try {
            Note existingNote = noteService.getNoteById(id);
            if (!existingNote.getUser().getId().equals(user.getId())) {
                return ResponseEntity.status(HttpStatus.FORBIDDEN).build();
            }

            Note unarchivedNote = noteService.unarchiveNote(id);
            NoteResponse response = NoteMapper.toResponse(unarchivedNote);

            return ResponseEntity.ok(response);
        } catch (RuntimeException e) {
            return ResponseEntity.notFound().build();
        }
    }

    @PostMapping
    public ResponseEntity<NoteResponse> createNote(@Valid @RequestBody NoteRequest noteRequest) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }
        // Create the note associated with the authenticated user
        Note note = Note.builder()
                .title(noteRequest.title())
                .content(noteRequest.content())
                .user(user)
                .build();

        if (note == null) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }

        Note createdNote = noteService.createNote(note);
        NoteResponse response = NoteMapper.toResponse(createdNote);

        return ResponseEntity.status(HttpStatus.CREATED).body(response);
    }

    @PutMapping("/{id}")
    public ResponseEntity<NoteResponse> updateNote(@PathVariable Long id, @Valid @RequestBody NoteRequest noteRequest) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }

        // Validate inputs
        String title = noteRequest.title();
        String content = noteRequest.content();
        if (id == null || title == null || content == null ||
                title.trim().isEmpty() || content.trim().isEmpty()) {
            return ResponseEntity.badRequest().build();
        }

        // Check if note exists and belongs to the authenticated user
        try {
            Note existingNote = noteService.getNoteById(id);
            if (!existingNote.getUser().getId().equals(user.getId())) {
                return ResponseEntity.status(HttpStatus.FORBIDDEN).build();
            }

            Note updatedNote = noteService.updateNote(id, title, content);
            NoteResponse response = NoteMapper.toResponse(updatedNote);

            return ResponseEntity.ok(response);
        } catch (RuntimeException e) {
            return ResponseEntity.notFound().build();
        }
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteNote(@PathVariable Long id) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }

        // Validate input
        if (id == null) {
            return ResponseEntity.badRequest().build();
        }

        // Get the note and check ownership
        Note note = noteService.getNoteById(id);

        if (!note.getUser().getId().equals(user.getId())) {
            return ResponseEntity.status(HttpStatus.FORBIDDEN).build();
        }
        noteService.deleteNote(id);
        return ResponseEntity.noContent().build();
    }

    @PostMapping("/{noteId}/tags/{tagId}")
    public ResponseEntity<NoteResponse> addTagToNote(@PathVariable Long noteId, @PathVariable Long tagId) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }

        // Validate input
        if (noteId == null || tagId == null) {
            return ResponseEntity.badRequest().build();
        }

        try {
            Note existingNote = noteService.getNoteById(noteId);
            if (!existingNote.getUser().getId().equals(user.getId())) {
                return ResponseEntity.status(HttpStatus.FORBIDDEN).build();
            }

            Note updatedNote = noteService.addTagToNote(noteId, tagId);
            NoteResponse response = NoteMapper.toResponse(updatedNote);

            return ResponseEntity.ok(response);
        } catch (RuntimeException e) {
            return ResponseEntity.notFound().build();
        }
    }

    @DeleteMapping("/{noteId}/tags/{tagId}")
    public ResponseEntity<NoteResponse> removeTagFromNote(@PathVariable Long noteId, @PathVariable Long tagId) {
        // Get the authenticated user
        User user = getAuthenticatedUser();
        if (user == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }

        // Validate input
        if (noteId == null || tagId == null) {
            return ResponseEntity.badRequest().build();
        }

        try {
            Note existingNote = noteService.getNoteById(noteId);
            if (!existingNote.getUser().getId().equals(user.getId())) {
                return ResponseEntity.status(HttpStatus.FORBIDDEN).build();
            }

            Note updatedNote = noteService.removeTagFromNote(noteId, tagId);
            NoteResponse response = NoteMapper.toResponse(updatedNote);

            return ResponseEntity.ok(response);
        } catch (RuntimeException e) {
            return ResponseEntity.notFound().build();
        }
    }

    private User getAuthenticatedUser() {
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        if (authentication == null || !authentication.isAuthenticated()) {
            return null;
        }

        String username = authentication.getName();
        if (username == null || username.trim().isEmpty()) {
            return null;
        }

        var userOptional = userService.findByUsername(username);
        return userOptional.get();
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/note/web/TagRestController.java">
package pe.ezer.backend.modules.note.web;

import java.util.List;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import pe.ezer.backend.modules.note.domain.Tag;
import pe.ezer.backend.modules.note.mapper.TagMapper;
import pe.ezer.backend.modules.note.service.TagService;
import pe.ezer.backend.modules.note.web.dto.TagRequest;
import pe.ezer.backend.modules.note.web.dto.TagResponse;

@RestController
@RequestMapping("/api/tags")
@RequiredArgsConstructor
public class TagRestController {
    private final TagService tagService;

    @GetMapping
    public ResponseEntity<List<TagResponse>> getAllTags() {
        List<Tag> tags = tagService.getAllTags();
        List<TagResponse> response = tags.stream()
                .map(TagMapper::toResponse)
                .toList();
        return ResponseEntity.ok(response);
    }

    @PostMapping
    public ResponseEntity<TagResponse> createTag(@Valid @RequestBody TagRequest tag) {
        Tag tags = TagMapper.toEntity(tag);
        if (tags == null) {
            return ResponseEntity.badRequest().build();
        }
        Tag createdTag = tagService.createTag(tags);
        TagResponse response = TagMapper.toResponse(createdTag);
        return ResponseEntity.status(HttpStatus.CREATED).body(response);
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteTag(@PathVariable Long id) {
        Long idtag = id;
        if (idtag == null) {
            return ResponseEntity.badRequest().build();
        }
        tagService.deleteTag(idtag);
        return ResponseEntity.noContent().build();
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/user/domain/User.java">
package pe.ezer.backend.modules.user.domain;

import java.time.LocalDateTime;

import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.Table;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(name = "users")
@Data
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class User {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "username", nullable = false, unique = true)
    private String username;

    @Column(name = "password", nullable = false)
    private String password;

    @CreationTimestamp
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @UpdateTimestamp
    @Column(name = "updated_at")
    private LocalDateTime updatedAt;
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/user/mapper/UserMapper.java">
package pe.ezer.backend.modules.user.mapper;

import pe.ezer.backend.modules.user.domain.User;
import pe.ezer.backend.modules.user.web.dto.UserRequest;
import pe.ezer.backend.modules.user.web.dto.UserResponse;

public final class UserMapper {

    public static User toEntity (UserRequest request){
        if (request == null) {
            return null;
        }
        User user = new User();
        user.setUsername(request.username());
        user.setPassword(request.password());
        return user;
    }

    public static UserResponse toResponse (User user){
        if (user == null) {
            return null;
        }
        return new UserResponse(
            user.getId(),
            user.getUsername(),
            user.getCreatedAt(),
            user.getUpdatedAt()
        );
    }
    
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/user/repo/UserRepository.java">
package pe.ezer.backend.modules.user.repo;

import java.util.Optional;

import org.springframework.data.jpa.repository.JpaRepository;

import pe.ezer.backend.modules.user.domain.User;

public interface UserRepository extends JpaRepository<User, Long> {
    public Optional<User> findByUsername(String username);
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/user/service/UserService.java">
package pe.ezer.backend.modules.user.service;

import java.util.List;
import java.util.Optional;

import org.springframework.lang.NonNull;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

import lombok.RequiredArgsConstructor;
import pe.ezer.backend.modules.user.domain.User;
import pe.ezer.backend.modules.user.repo.UserRepository;

@Service
@RequiredArgsConstructor
public class UserService {
    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;

    public User save(@NonNull User user) {
        user.setPassword(passwordEncoder.encode(user.getPassword()));
        return userRepository.save(user);
    }

    public User changePassword(@NonNull Long userId, @NonNull String newPassword) {
        User user = findById(userId);
        if (user != null) {
            user.setPassword(passwordEncoder.encode(newPassword));
            return userRepository.save(user);
        }
        return null;
    }

    public Optional<User> findByUsername(@NonNull String username) {
        return userRepository.findByUsername(username);
    }

    public User findById(@NonNull Long id) {
        return userRepository.findById(id).orElse(null);
    }

    public List<User> findAll() {
        return userRepository.findAll();
    }

    public void deleteById(@NonNull Long id) {
        userRepository.deleteById(id);
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/user/web/dto/AuthRequest.java">
package pe.ezer.backend.modules.user.web.dto;

public record AuthRequest(
    String username,
    String password
) {}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/user/web/dto/UserRequest.java">
package pe.ezer.backend.modules.user.web.dto;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;

public record UserRequest(
    @NotBlank(message = "Username is required")
    @Size(min = 3, max = 50, message = "Username must be between 3 and 50 characters")
    String username,
    @NotBlank(message = "Password is required")
    String password
) {}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/user/web/dto/UserResponse.java">
package pe.ezer.backend.modules.user.web.dto;

import java.time.LocalDateTime;

public record UserResponse(
    Long id,
    String username,
    LocalDateTime createdAt,
    LocalDateTime updatedAt
) {}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/user/web/AuthRestController.java">
package pe.ezer.backend.modules.user.web;

import java.util.Map;
import java.util.Optional;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import lombok.RequiredArgsConstructor;
import pe.ezer.backend.config.security.JwtUtil;
import pe.ezer.backend.modules.user.domain.User;
import pe.ezer.backend.modules.user.service.UserService;
import pe.ezer.backend.modules.user.web.dto.AuthRequest;

@RestController
@RequiredArgsConstructor
public class AuthRestController {

    private final UserService userService;
    private final PasswordEncoder passwordEncoder;
    private final JwtUtil jwtUtil;

    @PostMapping("/auth")
	public ResponseEntity<Map<String, String>> authenticate(@RequestBody AuthRequest authRequest) {
        String username = authRequest.username();
        if (username == null || username.isEmpty()) {
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).build();
        }
        Optional<User> user = userService.findByUsername(username);
		if (user.isPresent() && passwordEncoder.matches(authRequest.password(), user.get().getPassword())) {
			return ResponseEntity.ok(Map.of("token",jwtUtil.generateToken(user.get().getUsername())));
		} else {
			return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
		}
	}
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/modules/user/web/UserRestController.java">
package pe.ezer.backend.modules.user.web;

import java.util.List;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import lombok.RequiredArgsConstructor;
import pe.ezer.backend.modules.user.mapper.UserMapper;
import pe.ezer.backend.modules.user.service.UserService;
import pe.ezer.backend.modules.user.web.dto.UserRequest;
import pe.ezer.backend.modules.user.web.dto.UserResponse;

@RestController
@RequestMapping("/api/users")
@RequiredArgsConstructor
public class UserRestController {
    private final UserService userService;

    // Test endpoint to get all users
    @GetMapping
    public ResponseEntity<List<UserResponse>> getAllUsers() {
        var users = userService.findAll();
        var userResponses = users.stream()
                .map(UserMapper::toResponse)
                .toList();
        return ResponseEntity.ok(userResponses);
    }

    @PostMapping
    public ResponseEntity<UserResponse> createUser(@RequestBody UserRequest userRequest) {
        var user = UserMapper.toEntity(userRequest);
        if (user == null) {
            return ResponseEntity.badRequest().build();
        }
        var createdUser = userService.save(user);
        var userResponse = UserMapper.toResponse(createdUser);
        return ResponseEntity.ok(userResponse);
    }
}
</file>

<file path="backend/src/main/java/pe/ezer/backend/BackendApplication.java">
package pe.ezer.backend;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class BackendApplication {

	public static void main(String[] args) {
		SpringApplication.run(BackendApplication.class, args);
	}

}
</file>

<file path="backend/src/main/resources/application.properties">
spring.application.name=backend
server.port=8080

# Configuracin de la base de datos
spring.datasource.url=jdbc:mysql://localhost:3306/vidarte_db
spring.datasource.username=root
spring.datasource.password=
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.format_sql=true
</file>

<file path="backend/src/test/java/pe/ezer/backend/BackendApplicationTests.java">
package pe.ezer.backend;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class BackendApplicationTests {

	@Test
	void contextLoads() {
	}

}
</file>

<file path="backend/.gitattributes">
/mvnw text eol=lf
*.cmd text eol=crlf
</file>

<file path="backend/.gitignore">
HELP.md
target/
.mvn/wrapper/maven-wrapper.jar
!**/src/main/**/target/
!**/src/test/**/target/

### STS ###
.apt_generated
.classpath
.factorypath
.project
.settings
.springBeans
.sts4-cache

### IntelliJ IDEA ###
.idea
*.iws
*.iml
*.ipr

### NetBeans ###
/nbproject/private/
/nbbuild/
/dist/
/nbdist/
/.nb-gradle/
build/
!**/src/main/**/build/
!**/src/test/**/build/

### VS Code ###
.vscode/
</file>

<file path="backend/mvnw">
#!/bin/sh
# ----------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# Apache Maven Wrapper startup batch script, version 3.3.4
#
# Optional ENV vars
# -----------------
#   JAVA_HOME - location of a JDK home dir, required when download maven via java source
#   MVNW_REPOURL - repo url base for downloading maven distribution
#   MVNW_USERNAME/MVNW_PASSWORD - user and password for downloading maven
#   MVNW_VERBOSE - true: enable verbose log; debug: trace the mvnw script; others: silence the output
# ----------------------------------------------------------------------------

set -euf
[ "${MVNW_VERBOSE-}" != debug ] || set -x

# OS specific support.
native_path() { printf %s\\n "$1"; }
case "$(uname)" in
CYGWIN* | MINGW*)
  [ -z "${JAVA_HOME-}" ] || JAVA_HOME="$(cygpath --unix "$JAVA_HOME")"
  native_path() { cygpath --path --windows "$1"; }
  ;;
esac

# set JAVACMD and JAVACCMD
set_java_home() {
  # For Cygwin and MinGW, ensure paths are in Unix format before anything is touched
  if [ -n "${JAVA_HOME-}" ]; then
    if [ -x "$JAVA_HOME/jre/sh/java" ]; then
      # IBM's JDK on AIX uses strange locations for the executables
      JAVACMD="$JAVA_HOME/jre/sh/java"
      JAVACCMD="$JAVA_HOME/jre/sh/javac"
    else
      JAVACMD="$JAVA_HOME/bin/java"
      JAVACCMD="$JAVA_HOME/bin/javac"

      if [ ! -x "$JAVACMD" ] || [ ! -x "$JAVACCMD" ]; then
        echo "The JAVA_HOME environment variable is not defined correctly, so mvnw cannot run." >&2
        echo "JAVA_HOME is set to \"$JAVA_HOME\", but \"\$JAVA_HOME/bin/java\" or \"\$JAVA_HOME/bin/javac\" does not exist." >&2
        return 1
      fi
    fi
  else
    JAVACMD="$(
      'set' +e
      'unset' -f command 2>/dev/null
      'command' -v java
    )" || :
    JAVACCMD="$(
      'set' +e
      'unset' -f command 2>/dev/null
      'command' -v javac
    )" || :

    if [ ! -x "${JAVACMD-}" ] || [ ! -x "${JAVACCMD-}" ]; then
      echo "The java/javac command does not exist in PATH nor is JAVA_HOME set, so mvnw cannot run." >&2
      return 1
    fi
  fi
}

# hash string like Java String::hashCode
hash_string() {
  str="${1:-}" h=0
  while [ -n "$str" ]; do
    char="${str%"${str#?}"}"
    h=$(((h * 31 + $(LC_CTYPE=C printf %d "'$char")) % 4294967296))
    str="${str#?}"
  done
  printf %x\\n $h
}

verbose() { :; }
[ "${MVNW_VERBOSE-}" != true ] || verbose() { printf %s\\n "${1-}"; }

die() {
  printf %s\\n "$1" >&2
  exit 1
}

trim() {
  # MWRAPPER-139:
  #   Trims trailing and leading whitespace, carriage returns, tabs, and linefeeds.
  #   Needed for removing poorly interpreted newline sequences when running in more
  #   exotic environments such as mingw bash on Windows.
  printf "%s" "${1}" | tr -d '[:space:]'
}

scriptDir="$(dirname "$0")"
scriptName="$(basename "$0")"

# parse distributionUrl and optional distributionSha256Sum, requires .mvn/wrapper/maven-wrapper.properties
while IFS="=" read -r key value; do
  case "${key-}" in
  distributionUrl) distributionUrl=$(trim "${value-}") ;;
  distributionSha256Sum) distributionSha256Sum=$(trim "${value-}") ;;
  esac
done <"$scriptDir/.mvn/wrapper/maven-wrapper.properties"
[ -n "${distributionUrl-}" ] || die "cannot read distributionUrl property in $scriptDir/.mvn/wrapper/maven-wrapper.properties"

case "${distributionUrl##*/}" in
maven-mvnd-*bin.*)
  MVN_CMD=mvnd.sh _MVNW_REPO_PATTERN=/maven/mvnd/
  case "${PROCESSOR_ARCHITECTURE-}${PROCESSOR_ARCHITEW6432-}:$(uname -a)" in
  *AMD64:CYGWIN* | *AMD64:MINGW*) distributionPlatform=windows-amd64 ;;
  :Darwin*x86_64) distributionPlatform=darwin-amd64 ;;
  :Darwin*arm64) distributionPlatform=darwin-aarch64 ;;
  :Linux*x86_64*) distributionPlatform=linux-amd64 ;;
  *)
    echo "Cannot detect native platform for mvnd on $(uname)-$(uname -m), use pure java version" >&2
    distributionPlatform=linux-amd64
    ;;
  esac
  distributionUrl="${distributionUrl%-bin.*}-$distributionPlatform.zip"
  ;;
maven-mvnd-*) MVN_CMD=mvnd.sh _MVNW_REPO_PATTERN=/maven/mvnd/ ;;
*) MVN_CMD="mvn${scriptName#mvnw}" _MVNW_REPO_PATTERN=/org/apache/maven/ ;;
esac

# apply MVNW_REPOURL and calculate MAVEN_HOME
# maven home pattern: ~/.m2/wrapper/dists/{apache-maven-<version>,maven-mvnd-<version>-<platform>}/<hash>
[ -z "${MVNW_REPOURL-}" ] || distributionUrl="$MVNW_REPOURL$_MVNW_REPO_PATTERN${distributionUrl#*"$_MVNW_REPO_PATTERN"}"
distributionUrlName="${distributionUrl##*/}"
distributionUrlNameMain="${distributionUrlName%.*}"
distributionUrlNameMain="${distributionUrlNameMain%-bin}"
MAVEN_USER_HOME="${MAVEN_USER_HOME:-${HOME}/.m2}"
MAVEN_HOME="${MAVEN_USER_HOME}/wrapper/dists/${distributionUrlNameMain-}/$(hash_string "$distributionUrl")"

exec_maven() {
  unset MVNW_VERBOSE MVNW_USERNAME MVNW_PASSWORD MVNW_REPOURL || :
  exec "$MAVEN_HOME/bin/$MVN_CMD" "$@" || die "cannot exec $MAVEN_HOME/bin/$MVN_CMD"
}

if [ -d "$MAVEN_HOME" ]; then
  verbose "found existing MAVEN_HOME at $MAVEN_HOME"
  exec_maven "$@"
fi

case "${distributionUrl-}" in
*?-bin.zip | *?maven-mvnd-?*-?*.zip) ;;
*) die "distributionUrl is not valid, must match *-bin.zip or maven-mvnd-*.zip, but found '${distributionUrl-}'" ;;
esac

# prepare tmp dir
if TMP_DOWNLOAD_DIR="$(mktemp -d)" && [ -d "$TMP_DOWNLOAD_DIR" ]; then
  clean() { rm -rf -- "$TMP_DOWNLOAD_DIR"; }
  trap clean HUP INT TERM EXIT
else
  die "cannot create temp dir"
fi

mkdir -p -- "${MAVEN_HOME%/*}"

# Download and Install Apache Maven
verbose "Couldn't find MAVEN_HOME, downloading and installing it ..."
verbose "Downloading from: $distributionUrl"
verbose "Downloading to: $TMP_DOWNLOAD_DIR/$distributionUrlName"

# select .zip or .tar.gz
if ! command -v unzip >/dev/null; then
  distributionUrl="${distributionUrl%.zip}.tar.gz"
  distributionUrlName="${distributionUrl##*/}"
fi

# verbose opt
__MVNW_QUIET_WGET=--quiet __MVNW_QUIET_CURL=--silent __MVNW_QUIET_UNZIP=-q __MVNW_QUIET_TAR=''
[ "${MVNW_VERBOSE-}" != true ] || __MVNW_QUIET_WGET='' __MVNW_QUIET_CURL='' __MVNW_QUIET_UNZIP='' __MVNW_QUIET_TAR=v

# normalize http auth
case "${MVNW_PASSWORD:+has-password}" in
'') MVNW_USERNAME='' MVNW_PASSWORD='' ;;
has-password) [ -n "${MVNW_USERNAME-}" ] || MVNW_USERNAME='' MVNW_PASSWORD='' ;;
esac

if [ -z "${MVNW_USERNAME-}" ] && command -v wget >/dev/null; then
  verbose "Found wget ... using wget"
  wget ${__MVNW_QUIET_WGET:+"$__MVNW_QUIET_WGET"} "$distributionUrl" -O "$TMP_DOWNLOAD_DIR/$distributionUrlName" || die "wget: Failed to fetch $distributionUrl"
elif [ -z "${MVNW_USERNAME-}" ] && command -v curl >/dev/null; then
  verbose "Found curl ... using curl"
  curl ${__MVNW_QUIET_CURL:+"$__MVNW_QUIET_CURL"} -f -L -o "$TMP_DOWNLOAD_DIR/$distributionUrlName" "$distributionUrl" || die "curl: Failed to fetch $distributionUrl"
elif set_java_home; then
  verbose "Falling back to use Java to download"
  javaSource="$TMP_DOWNLOAD_DIR/Downloader.java"
  targetZip="$TMP_DOWNLOAD_DIR/$distributionUrlName"
  cat >"$javaSource" <<-END
	public class Downloader extends java.net.Authenticator
	{
	  protected java.net.PasswordAuthentication getPasswordAuthentication()
	  {
	    return new java.net.PasswordAuthentication( System.getenv( "MVNW_USERNAME" ), System.getenv( "MVNW_PASSWORD" ).toCharArray() );
	  }
	  public static void main( String[] args ) throws Exception
	  {
	    setDefault( new Downloader() );
	    java.nio.file.Files.copy( java.net.URI.create( args[0] ).toURL().openStream(), java.nio.file.Paths.get( args[1] ).toAbsolutePath().normalize() );
	  }
	}
	END
  # For Cygwin/MinGW, switch paths to Windows format before running javac and java
  verbose " - Compiling Downloader.java ..."
  "$(native_path "$JAVACCMD")" "$(native_path "$javaSource")" || die "Failed to compile Downloader.java"
  verbose " - Running Downloader.java ..."
  "$(native_path "$JAVACMD")" -cp "$(native_path "$TMP_DOWNLOAD_DIR")" Downloader "$distributionUrl" "$(native_path "$targetZip")"
fi

# If specified, validate the SHA-256 sum of the Maven distribution zip file
if [ -n "${distributionSha256Sum-}" ]; then
  distributionSha256Result=false
  if [ "$MVN_CMD" = mvnd.sh ]; then
    echo "Checksum validation is not supported for maven-mvnd." >&2
    echo "Please disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties." >&2
    exit 1
  elif command -v sha256sum >/dev/null; then
    if echo "$distributionSha256Sum  $TMP_DOWNLOAD_DIR/$distributionUrlName" | sha256sum -c - >/dev/null 2>&1; then
      distributionSha256Result=true
    fi
  elif command -v shasum >/dev/null; then
    if echo "$distributionSha256Sum  $TMP_DOWNLOAD_DIR/$distributionUrlName" | shasum -a 256 -c >/dev/null 2>&1; then
      distributionSha256Result=true
    fi
  else
    echo "Checksum validation was requested but neither 'sha256sum' or 'shasum' are available." >&2
    echo "Please install either command, or disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties." >&2
    exit 1
  fi
  if [ $distributionSha256Result = false ]; then
    echo "Error: Failed to validate Maven distribution SHA-256, your Maven distribution might be compromised." >&2
    echo "If you updated your Maven version, you need to update the specified distributionSha256Sum property." >&2
    exit 1
  fi
fi

# unzip and move
if command -v unzip >/dev/null; then
  unzip ${__MVNW_QUIET_UNZIP:+"$__MVNW_QUIET_UNZIP"} "$TMP_DOWNLOAD_DIR/$distributionUrlName" -d "$TMP_DOWNLOAD_DIR" || die "failed to unzip"
else
  tar xzf${__MVNW_QUIET_TAR:+"$__MVNW_QUIET_TAR"} "$TMP_DOWNLOAD_DIR/$distributionUrlName" -C "$TMP_DOWNLOAD_DIR" || die "failed to untar"
fi

# Find the actual extracted directory name (handles snapshots where filename != directory name)
actualDistributionDir=""

# First try the expected directory name (for regular distributions)
if [ -d "$TMP_DOWNLOAD_DIR/$distributionUrlNameMain" ]; then
  if [ -f "$TMP_DOWNLOAD_DIR/$distributionUrlNameMain/bin/$MVN_CMD" ]; then
    actualDistributionDir="$distributionUrlNameMain"
  fi
fi

# If not found, search for any directory with the Maven executable (for snapshots)
if [ -z "$actualDistributionDir" ]; then
  # enable globbing to iterate over items
  set +f
  for dir in "$TMP_DOWNLOAD_DIR"/*; do
    if [ -d "$dir" ]; then
      if [ -f "$dir/bin/$MVN_CMD" ]; then
        actualDistributionDir="$(basename "$dir")"
        break
      fi
    fi
  done
  set -f
fi

if [ -z "$actualDistributionDir" ]; then
  verbose "Contents of $TMP_DOWNLOAD_DIR:"
  verbose "$(ls -la "$TMP_DOWNLOAD_DIR")"
  die "Could not find Maven distribution directory in extracted archive"
fi

verbose "Found extracted Maven distribution directory: $actualDistributionDir"
printf %s\\n "$distributionUrl" >"$TMP_DOWNLOAD_DIR/$actualDistributionDir/mvnw.url"
mv -- "$TMP_DOWNLOAD_DIR/$actualDistributionDir" "$MAVEN_HOME" || [ -d "$MAVEN_HOME" ] || die "fail to move MAVEN_HOME"

clean || :
exec_maven "$@"
</file>

<file path="backend/mvnw.cmd">
<# : batch portion
@REM ----------------------------------------------------------------------------
@REM Licensed to the Apache Software Foundation (ASF) under one
@REM or more contributor license agreements.  See the NOTICE file
@REM distributed with this work for additional information
@REM regarding copyright ownership.  The ASF licenses this file
@REM to you under the Apache License, Version 2.0 (the
@REM "License"); you may not use this file except in compliance
@REM with the License.  You may obtain a copy of the License at
@REM
@REM    http://www.apache.org/licenses/LICENSE-2.0
@REM
@REM Unless required by applicable law or agreed to in writing,
@REM software distributed under the License is distributed on an
@REM "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
@REM KIND, either express or implied.  See the License for the
@REM specific language governing permissions and limitations
@REM under the License.
@REM ----------------------------------------------------------------------------

@REM ----------------------------------------------------------------------------
@REM Apache Maven Wrapper startup batch script, version 3.3.4
@REM
@REM Optional ENV vars
@REM   MVNW_REPOURL - repo url base for downloading maven distribution
@REM   MVNW_USERNAME/MVNW_PASSWORD - user and password for downloading maven
@REM   MVNW_VERBOSE - true: enable verbose log; others: silence the output
@REM ----------------------------------------------------------------------------

@IF "%__MVNW_ARG0_NAME__%"=="" (SET __MVNW_ARG0_NAME__=%~nx0)
@SET __MVNW_CMD__=
@SET __MVNW_ERROR__=
@SET __MVNW_PSMODULEP_SAVE=%PSModulePath%
@SET PSModulePath=
@FOR /F "usebackq tokens=1* delims==" %%A IN (`powershell -noprofile "& {$scriptDir='%~dp0'; $script='%__MVNW_ARG0_NAME__%'; icm -ScriptBlock ([Scriptblock]::Create((Get-Content -Raw '%~f0'))) -NoNewScope}"`) DO @(
  IF "%%A"=="MVN_CMD" (set __MVNW_CMD__=%%B) ELSE IF "%%B"=="" (echo %%A) ELSE (echo %%A=%%B)
)
@SET PSModulePath=%__MVNW_PSMODULEP_SAVE%
@SET __MVNW_PSMODULEP_SAVE=
@SET __MVNW_ARG0_NAME__=
@SET MVNW_USERNAME=
@SET MVNW_PASSWORD=
@IF NOT "%__MVNW_CMD__%"=="" ("%__MVNW_CMD__%" %*)
@echo Cannot start maven from wrapper >&2 && exit /b 1
@GOTO :EOF
: end batch / begin powershell #>

$ErrorActionPreference = "Stop"
if ($env:MVNW_VERBOSE -eq "true") {
  $VerbosePreference = "Continue"
}

# calculate distributionUrl, requires .mvn/wrapper/maven-wrapper.properties
$distributionUrl = (Get-Content -Raw "$scriptDir/.mvn/wrapper/maven-wrapper.properties" | ConvertFrom-StringData).distributionUrl
if (!$distributionUrl) {
  Write-Error "cannot read distributionUrl property in $scriptDir/.mvn/wrapper/maven-wrapper.properties"
}

switch -wildcard -casesensitive ( $($distributionUrl -replace '^.*/','') ) {
  "maven-mvnd-*" {
    $USE_MVND = $true
    $distributionUrl = $distributionUrl -replace '-bin\.[^.]*$',"-windows-amd64.zip"
    $MVN_CMD = "mvnd.cmd"
    break
  }
  default {
    $USE_MVND = $false
    $MVN_CMD = $script -replace '^mvnw','mvn'
    break
  }
}

# apply MVNW_REPOURL and calculate MAVEN_HOME
# maven home pattern: ~/.m2/wrapper/dists/{apache-maven-<version>,maven-mvnd-<version>-<platform>}/<hash>
if ($env:MVNW_REPOURL) {
  $MVNW_REPO_PATTERN = if ($USE_MVND -eq $False) { "/org/apache/maven/" } else { "/maven/mvnd/" }
  $distributionUrl = "$env:MVNW_REPOURL$MVNW_REPO_PATTERN$($distributionUrl -replace "^.*$MVNW_REPO_PATTERN",'')"
}
$distributionUrlName = $distributionUrl -replace '^.*/',''
$distributionUrlNameMain = $distributionUrlName -replace '\.[^.]*$','' -replace '-bin$',''

$MAVEN_M2_PATH = "$HOME/.m2"
if ($env:MAVEN_USER_HOME) {
  $MAVEN_M2_PATH = "$env:MAVEN_USER_HOME"
}

if (-not (Test-Path -Path $MAVEN_M2_PATH)) {
    New-Item -Path $MAVEN_M2_PATH -ItemType Directory | Out-Null
}

$MAVEN_WRAPPER_DISTS = $null
if ((Get-Item $MAVEN_M2_PATH).Target[0] -eq $null) {
  $MAVEN_WRAPPER_DISTS = "$MAVEN_M2_PATH/wrapper/dists"
} else {
  $MAVEN_WRAPPER_DISTS = (Get-Item $MAVEN_M2_PATH).Target[0] + "/wrapper/dists"
}

$MAVEN_HOME_PARENT = "$MAVEN_WRAPPER_DISTS/$distributionUrlNameMain"
$MAVEN_HOME_NAME = ([System.Security.Cryptography.SHA256]::Create().ComputeHash([byte[]][char[]]$distributionUrl) | ForEach-Object {$_.ToString("x2")}) -join ''
$MAVEN_HOME = "$MAVEN_HOME_PARENT/$MAVEN_HOME_NAME"

if (Test-Path -Path "$MAVEN_HOME" -PathType Container) {
  Write-Verbose "found existing MAVEN_HOME at $MAVEN_HOME"
  Write-Output "MVN_CMD=$MAVEN_HOME/bin/$MVN_CMD"
  exit $?
}

if (! $distributionUrlNameMain -or ($distributionUrlName -eq $distributionUrlNameMain)) {
  Write-Error "distributionUrl is not valid, must end with *-bin.zip, but found $distributionUrl"
}

# prepare tmp dir
$TMP_DOWNLOAD_DIR_HOLDER = New-TemporaryFile
$TMP_DOWNLOAD_DIR = New-Item -Itemtype Directory -Path "$TMP_DOWNLOAD_DIR_HOLDER.dir"
$TMP_DOWNLOAD_DIR_HOLDER.Delete() | Out-Null
trap {
  if ($TMP_DOWNLOAD_DIR.Exists) {
    try { Remove-Item $TMP_DOWNLOAD_DIR -Recurse -Force | Out-Null }
    catch { Write-Warning "Cannot remove $TMP_DOWNLOAD_DIR" }
  }
}

New-Item -Itemtype Directory -Path "$MAVEN_HOME_PARENT" -Force | Out-Null

# Download and Install Apache Maven
Write-Verbose "Couldn't find MAVEN_HOME, downloading and installing it ..."
Write-Verbose "Downloading from: $distributionUrl"
Write-Verbose "Downloading to: $TMP_DOWNLOAD_DIR/$distributionUrlName"

$webclient = New-Object System.Net.WebClient
if ($env:MVNW_USERNAME -and $env:MVNW_PASSWORD) {
  $webclient.Credentials = New-Object System.Net.NetworkCredential($env:MVNW_USERNAME, $env:MVNW_PASSWORD)
}
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
$webclient.DownloadFile($distributionUrl, "$TMP_DOWNLOAD_DIR/$distributionUrlName") | Out-Null

# If specified, validate the SHA-256 sum of the Maven distribution zip file
$distributionSha256Sum = (Get-Content -Raw "$scriptDir/.mvn/wrapper/maven-wrapper.properties" | ConvertFrom-StringData).distributionSha256Sum
if ($distributionSha256Sum) {
  if ($USE_MVND) {
    Write-Error "Checksum validation is not supported for maven-mvnd. `nPlease disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties."
  }
  Import-Module $PSHOME\Modules\Microsoft.PowerShell.Utility -Function Get-FileHash
  if ((Get-FileHash "$TMP_DOWNLOAD_DIR/$distributionUrlName" -Algorithm SHA256).Hash.ToLower() -ne $distributionSha256Sum) {
    Write-Error "Error: Failed to validate Maven distribution SHA-256, your Maven distribution might be compromised. If you updated your Maven version, you need to update the specified distributionSha256Sum property."
  }
}

# unzip and move
Expand-Archive "$TMP_DOWNLOAD_DIR/$distributionUrlName" -DestinationPath "$TMP_DOWNLOAD_DIR" | Out-Null

# Find the actual extracted directory name (handles snapshots where filename != directory name)
$actualDistributionDir = ""

# First try the expected directory name (for regular distributions)
$expectedPath = Join-Path "$TMP_DOWNLOAD_DIR" "$distributionUrlNameMain"
$expectedMvnPath = Join-Path "$expectedPath" "bin/$MVN_CMD"
if ((Test-Path -Path $expectedPath -PathType Container) -and (Test-Path -Path $expectedMvnPath -PathType Leaf)) {
  $actualDistributionDir = $distributionUrlNameMain
}

# If not found, search for any directory with the Maven executable (for snapshots)
if (!$actualDistributionDir) {
  Get-ChildItem -Path "$TMP_DOWNLOAD_DIR" -Directory | ForEach-Object {
    $testPath = Join-Path $_.FullName "bin/$MVN_CMD"
    if (Test-Path -Path $testPath -PathType Leaf) {
      $actualDistributionDir = $_.Name
    }
  }
}

if (!$actualDistributionDir) {
  Write-Error "Could not find Maven distribution directory in extracted archive"
}

Write-Verbose "Found extracted Maven distribution directory: $actualDistributionDir"
Rename-Item -Path "$TMP_DOWNLOAD_DIR/$actualDistributionDir" -NewName $MAVEN_HOME_NAME | Out-Null
try {
  Move-Item -Path "$TMP_DOWNLOAD_DIR/$MAVEN_HOME_NAME" -Destination $MAVEN_HOME_PARENT | Out-Null
} catch {
  if (! (Test-Path -Path "$MAVEN_HOME" -PathType Container)) {
    Write-Error "fail to move MAVEN_HOME"
  }
} finally {
  try { Remove-Item $TMP_DOWNLOAD_DIR -Recurse -Force | Out-Null }
  catch { Write-Warning "Cannot remove $TMP_DOWNLOAD_DIR" }
}

Write-Output "MVN_CMD=$MAVEN_HOME/bin/$MVN_CMD"
</file>

<file path="backend/pom.xml">
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>3.5.8-SNAPSHOT</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<groupId>pe.ezer</groupId>
	<artifactId>backend</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>backend</name>
	<description>Demo project for Spring Boot</description>
	<url/>
	<licenses>
		<license/>
	</licenses>
	<developers>
		<developer/>
	</developers>
	<scm>
		<connection/>
		<developerConnection/>
		<tag/>
		<url/>
	</scm>
	<properties>
		<java.version>21</java.version>
	</properties>
	<dependencies>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-actuator</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-validation</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>
		<dependency>
			<groupId>io.jsonwebtoken</groupId>
			<artifactId>jjwt-api</artifactId>
			<version>0.12.5</version>
		</dependency>
		<dependency>
			<groupId>io.jsonwebtoken</groupId>
			<artifactId>jjwt-impl</artifactId>
			<version>0.12.5</version>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>io.jsonwebtoken</groupId>
			<artifactId>jjwt-jackson</artifactId>
			<version>0.12.5</version>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-devtools</artifactId>
			<scope>runtime</scope>
			<optional>true</optional>
		</dependency>
		<dependency>
			<groupId>com.mysql</groupId>
			<artifactId>mysql-connector-j</artifactId>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<optional>true</optional>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-security</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<version>3.11.0</version>
				<configuration>
					<source>21</source>
					<target>21</target>
					<release>21</release>
					<annotationProcessorPaths>
						<path>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
							<version>${lombok.version}</version>
						</path>
					</annotationProcessorPaths>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
				<configuration>
					<excludes>
						<exclude>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
						</exclude>
					</excludes>
				</configuration>
			</plugin>
		</plugins>
	</build>
	<repositories>
		<repository>
			<id>spring-snapshots</id>
			<name>Spring Snapshots</name>
			<url>https://repo.spring.io/snapshot</url>
			<releases>
				<enabled>false</enabled>
			</releases>
		</repository>
	</repositories>
	<pluginRepositories>
		<pluginRepository>
			<id>spring-snapshots</id>
			<name>Spring Snapshots</name>
			<url>https://repo.spring.io/snapshot</url>
			<releases>
				<enabled>false</enabled>
			</releases>
		</pluginRepository>
	</pluginRepositories>

</project>
</file>

<file path="frontend/.vscode/extensions.json">
{
  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=827846
  "recommendations": ["angular.ng-template"]
}
</file>

<file path="frontend/.vscode/launch.json">
{
  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
  "version": "0.2.0",
  "configurations": [
    {
      "name": "ng serve",
      "type": "chrome",
      "request": "launch",
      "preLaunchTask": "npm: start",
      "url": "http://localhost:4200/"
    },
    {
      "name": "ng test",
      "type": "chrome",
      "request": "launch",
      "preLaunchTask": "npm: test",
      "url": "http://localhost:9876/debug.html"
    }
  ]
}
</file>

<file path="frontend/.vscode/tasks.json">
{
  // For more information, visit: https://go.microsoft.com/fwlink/?LinkId=733558
  "version": "2.0.0",
  "tasks": [
    {
      "type": "npm",
      "script": "start",
      "isBackground": true,
      "problemMatcher": {
        "owner": "typescript",
        "pattern": "$tsc",
        "background": {
          "activeOnStart": true,
          "beginsPattern": {
            "regexp": "(.*?)"
          },
          "endsPattern": {
            "regexp": "bundle generation complete"
          }
        }
      }
    },
    {
      "type": "npm",
      "script": "test",
      "isBackground": true,
      "problemMatcher": {
        "owner": "typescript",
        "pattern": "$tsc",
        "background": {
          "activeOnStart": true,
          "beginsPattern": {
            "regexp": "(.*?)"
          },
          "endsPattern": {
            "regexp": "bundle generation complete"
          }
        }
      }
    }
  ]
}
</file>

<file path="frontend/src/app/core/guards/auth.guard.ts">
import { CanActivateFn, Router } from '@angular/router';
import { inject } from '@angular/core';
import { AuthService } from '../../features/auth/services/auth.service';

export const authGuard: CanActivateFn = (route, state) => {

  const authService = inject(AuthService);
  const router = inject(Router);

  // Check if the user is logged in
  if (!authService.isLoggedIn()) {
    router.navigate(['/auth/login']);
    return false;
  }

  // If the user is logged in, allow access
  return true;
};
</file>

<file path="frontend/src/app/core/interceptors/auth.interceptor.ts">
import { HttpInterceptorFn } from '@angular/common/http';
import { inject } from '@angular/core';
import { AuthService } from '../../features/auth/services/auth.service';

export const authInterceptor: HttpInterceptorFn = (req, next) => {
  const authService = inject(AuthService);

  const token = authService.getToken();

  // If there's no token, proceed with the original request
  if (!token) {
    return next(req);
  }

  // Clone the request and add the token to the Authorization header
  const authReq = req.clone({
    setHeaders: {
      Authorization: `Bearer ${token}`
    }
  });

  return next(authReq);
};
</file>

<file path="frontend/src/app/features/auth/models/login-request.ts">
export interface LoginRequest {
  username: string;
  password: string;
}
</file>

<file path="frontend/src/app/features/auth/models/login-response.ts">
export interface LoginResponse {
  token: string;
}
</file>

<file path="frontend/src/app/features/auth/pages/login/login.component.css">

</file>

<file path="frontend/src/app/features/auth/pages/login/login.component.html">
<div class="min-h-screen flex items-center justify-center bg-gray-100 px-4">
    <div class="w-full max-w-md bg-white shadow-lg rounded-xl p-8">

        <!-- Ttulo -->
        <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">
            Login
        </h2>

        <!-- Form -->
        <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-5">

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Username
                </label>
                <input type="text" formControlName="username" placeholder="user" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2
          focus:ring-blue-500 focus:outline-none" />
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Password
                </label>
                <input type="password" formControlName="password" placeholder="********" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2
          focus:ring-blue-500 focus:outline-none" />
            </div>

            <!-- Button -->
            <button type="submit" [disabled]="form.invalid || loading" class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-300
         text-white py-2 rounded-lg font-semibold transition-all flex justify-center items-center gap-2">

                @if (!loading) {
                    <span>Login</span>
                }

                @if (loading) {
                    <span class="flex items-center gap-2">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                        </svg>
                        Loading...
                    </span>
                }

            </button>
        </form>
    </div>
</div>
</file>

<file path="frontend/src/app/features/auth/pages/login/login.component.spec.ts">
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { LoginComponent } from './login.component';

describe('LoginComponent', () => {
  let component: LoginComponent;
  let fixture: ComponentFixture<LoginComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [LoginComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(LoginComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});
</file>

<file path="frontend/src/app/features/auth/pages/login/login.component.ts">
import { Component } from '@angular/core';
import { ReactiveFormsModule, FormGroup } from '@angular/forms';
import { FormBuilder } from '@angular/forms';
import { AuthService } from '../../services/auth.service';
import { Router } from '@angular/router';
import { ToastrService } from 'ngx-toastr';


@Component({
  selector: 'app-login',
  standalone: true,
  imports: [ReactiveFormsModule],
  templateUrl: './login.component.html',
  styleUrl: './login.component.css'
})

export class LoginComponent {
  form!: FormGroup;
  loading = false;

  constructor(
    private fb: FormBuilder,
    private authService: AuthService,
    private router: Router,
    private toastr: ToastrService
  ) {
    this.form = this.fb.group({
      username: [''],
      password: ['']
    });
  }

  errorMessage = '';

  submit() {
    if (this.form.invalid) return;
    this.loading = true;
    this.authService.login(this.form.value as any).subscribe({
      next: () => {
        this.loading = false;
        this.router.navigate(['/notes'])
      },
      error: (err) => {
        this.loading = false;
        console.log('ERROR BACKEND:', err);

        this.handleError(err);
      }
    });
  }

  handleError(err: any) {

    if (!err.status) {
      // When status is 0 or undefined, it usually means a network error
      this.toastr.error('Unable to connect to the server. Please check your connection.', 'Connection Error');
      return;
    }

    if (err.status === 401) {
      this.toastr.warning('Your email or password is incorrect', 'Invalid Credentials');
      return;
    }

    this.toastr.error('An error occurred. Please try again', 'Unexpected Error');
  }
}
</file>

<file path="frontend/src/app/features/auth/services/auth.service.ts">
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable, tap } from 'rxjs';
import { LoginRequest } from '../models/login-request';
import { LoginResponse } from '../models/login-response';

@Injectable({
  providedIn: 'root'
})
export class AuthService {

  private api = 'http://localhost:8080/auth';

  constructor(private http: HttpClient) {}

  login(request: LoginRequest): Observable<LoginResponse> {
    return this.http.post<LoginResponse>(this.api, request)
      .pipe(
        tap(res => {
          localStorage.setItem('token', res.token);
        })
      );
  }

  getToken() {
    return localStorage.getItem('token');
  }

  logout() {
    localStorage.removeItem('token');
  }

  isLoggedIn(): boolean {
    return !!this.getToken();
  }
}
</file>

<file path="frontend/src/app/features/auth/auth.routes.ts">
import { Routes } from '@angular/router';
import { LoginComponent } from './pages/login/login.component';

export const AUTH_ROUTES: Routes = [
  { path: 'login', component: LoginComponent }
];
</file>

<file path="frontend/src/app/features/notes/components/note-card/note-card.component.css">

</file>

<file path="frontend/src/app/features/notes/components/note-card/note-card.component.html">
<div
  class="bg-yellow-100 shadow-md hover:shadow-xl transition-shadow duration-300 rounded-lg p-6 cursor-pointer relative transform hover:-rotate-1 hover:scale-105 border-t-4 border-yellow-300"
  (click)="onSelect()">
  <!-- Title -->
  <h3 class="font-bold text-lg text-gray-800 mb-3 line-clamp-2">
    {{ note.title }}
  </h3>

  <!-- Content -->
  <p class="text-gray-700 text-sm mb-4 line-clamp-4 whitespace-pre-wrap">
    {{ truncateContent(note.content) }}
  </p>

  <!-- Tags Count -->
  <div class="flex items-center gap-1 mb-3">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24"
      stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
    </svg>
    <span class="text-xs text-gray-600 font-medium">
      {{ note.tagsCount }} {{ note.tagsCount === 1 ? 'tag' : 'tags' }}
    </span>
  </div>

  <!-- Date -->
  <div class="text-xs text-gray-500 mb-3">
    {{ note.updatedAt | date:'dd/MM/yyyy HH:mm' }}
  </div>

  <!-- Actions -->
  <div class="flex gap-2 justify-end">
    @if (!isArchived) {
    <button (click)="onEdit($event)"
      class="text-gray-600 hover:text-yellow-600 transition-colors p-1 rounded hover:bg-yellow-200" title="Edit note">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
      </svg>
    </button>
    <button (click)="onArchive($event)"
      class="text-gray-600 hover:text-blue-600 transition-colors p-1 rounded hover:bg-yellow-200" title="Archive note">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
      </svg>
    </button>
    } @else {
    <button (click)="onUnarchive($event)"
      class="text-gray-600 hover:text-green-600 transition-colors p-1 rounded hover:bg-yellow-200"
      title="Unarchive note">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
      </svg>
    </button>
    }
    <button (click)="onDelete($event)"
      class="text-gray-600 hover:text-red-600 transition-colors p-1 rounded hover:bg-yellow-200" title="Delete note">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
    </button>
  </div>
</div>

<!-- Modal Post-it -->
@if (isModalOpen) {
<div class="fixed inset-0 bg-white/30 backdrop-blur-sm flex items-center justify-center z-50 p-4"
  (click)="onBackdropClick($event)">
  <!-- Post-it Modal -->
  <div
    class="bg-yellow-100 shadow-2xl rounded-lg max-w-2xl w-full max-h-[80vh] overflow-hidden border-t-8 border-yellow-300 transform rotate-1">
    <!-- Header -->
    <div class="bg-yellow-200 px-6 py-4 flex justify-between items-center border-b border-yellow-300">
      <h2 class="text-2xl font-bold text-gray-800">
        {{ note.title }}
      </h2>
      <button (click)="closeModal()" class="text-gray-600 hover:text-gray-800 transition-colors" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Content -->
    <div class="p-6 overflow-y-auto max-h-[calc(80vh-140px)]">
      <p class="text-gray-800 text-base whitespace-pre-wrap leading-relaxed mb-6">
        {{ note.content }}
      </p>

      <!-- Tags Section -->
      @if (note.tags && note.tags.length > 0) {
      <div class="mt-6 pt-4 border-t border-yellow-300">
        <h3 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
          </svg>
          Tags
        </h3>
        <div class="flex flex-wrap gap-2">
          @for (tag of note.tags; track tag) {
          <span
            class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-300 text-gray-800 shadow-sm">
            {{ tag }}
          </span>
          }
        </div>
      </div>
      }
    </div>

    <!-- Footer with date -->
    <div class="bg-yellow-200 px-6 py-3 border-t border-yellow-300">
      <div class="flex justify-between items-center text-sm text-gray-600">
        <span>Created : {{ note.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
        <span>Updated: {{ note.updatedAt | date:'dd/MM/yyyy HH:mm' }}</span>
      </div>
    </div>
  </div>
</div>
}
</file>

<file path="frontend/src/app/features/notes/components/note-card/note-card.component.spec.ts">
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { NoteCardComponent } from './note-card.component';

describe('NoteCardComponent', () => {
  let component: NoteCardComponent;
  let fixture: ComponentFixture<NoteCardComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [NoteCardComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(NoteCardComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});
</file>

<file path="frontend/src/app/features/notes/components/note-card/note-card.component.ts">
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { CommonModule } from '@angular/common';
import { Router } from '@angular/router';
import { NoteResponse } from '../../models/note-response';

@Component({
  selector: 'app-note-card',
  imports: [CommonModule],
  templateUrl: './note-card.component.html',
  styleUrl: './note-card.component.css'
})
export class NoteCardComponent {
  @Input() note!: NoteResponse;
  @Input() isArchived: boolean = false;
  @Output() archive = new EventEmitter<number>();
  @Output() unarchive = new EventEmitter<number>();
  @Output() delete = new EventEmitter<number>();
  @Output() edit = new EventEmitter<NoteResponse>();

  isModalOpen: boolean = false;

  constructor(private router: Router) {}

  onSelect(): void {
    this.isModalOpen = true;
  }

  closeModal(): void {
    this.isModalOpen = false;
  }

  onBackdropClick(event: Event): void {
    if (event.target === event.currentTarget) {
      this.closeModal();
    }
  }

  onArchive(event: Event): void {
    event.stopPropagation();
    this.archive.emit(this.note.id);
  }

  onUnarchive(event: Event): void {
    event.stopPropagation();
    this.unarchive.emit(this.note.id);
  }

  onEdit(event: Event): void {
    event.stopPropagation();
    this.edit.emit(this.note);
  }

  onDelete(event: Event): void {
    event.stopPropagation();
    if (confirm('Are you sure you want to delete this note?')) {
      this.delete.emit(this.note.id);
    }
  }

  truncateContent(content: string, maxLength: number = 35): string {
    if (content.length <= maxLength) {
      return content;
    }

    return content.substring(0, maxLength) + '...';
  }
}
</file>

<file path="frontend/src/app/features/notes/components/note-form/note-form.component.css">

</file>

<file path="frontend/src/app/features/notes/components/note-form/note-form.component.html">
<!-- Modal Backdrop -->
@if (isOpen) {
  <div 
    class="fixed inset-0 bg-white/30 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    (click)="onBackdropClick($event)"
  >
    <!-- Modal Content -->
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
      <!-- Header -->
      <div class="bg-blue-600 text-white px-6 py-4 flex justify-between items-center">
        <h2 class="text-xl font-bold">
          {{ isEditMode ? 'Edit Note' : 'New Note' }}
        </h2>
        <button 
          (click)="onClose()"
          class="text-white hover:text-gray-200 transition-colors"
          type="button"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Form -->
      <form [formGroup]="noteForm" (ngSubmit)="onSubmit()" class="p-6">
        <!-- Title Field -->
        <div class="mb-6">
          <label for="title" class="block text-sm font-semibold text-gray-700 mb-2">
            Title *
          </label>
          <input
            id="title"
            type="text"
            formControlName="title"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="Enter the title of your note"
          />
          @if (noteForm.get('title')?.invalid && noteForm.get('title')?.touched) {
            <p class="text-red-500 text-sm mt-1">
              @if (noteForm.get('title')?.errors?.['required']) {
                Title is required
              }
              @if (noteForm.get('title')?.errors?.['maxlength']) {
                Title cannot exceed 255 characters
              }
            </p>
          }
        </div>

        <!-- Content Field -->
        <div class="mb-6">
          <label for="content" class="block text-sm font-semibold text-gray-700 mb-2">
            Content *
          </label>
          <textarea
            id="content"
            formControlName="content"
            rows="10"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
            placeholder="Enter the content of your note..."
          ></textarea>
          @if (noteForm.get('content')?.invalid && noteForm.get('content')?.touched) {
            <p class="text-red-500 text-sm mt-1">
              Content is required
            </p>
          }
        </div>

        <!-- Tags Field -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Tags
          </label>
          
          <!-- Selected Tags -->
          @if (selectedTags.length > 0) {
            <div class="flex flex-wrap gap-2 mb-3">
              @for (tag of selectedTags; track tag.id) {
                <span class="inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                  {{ tag.name }}
                  <button
                    type="button"
                    (click)="removeTag(tag.id)"
                    class="hover:text-blue-600 transition-colors"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </span>
              }
            </div>
          }

          <!-- Add Tag Dropdown -->
          @if (availableTagsForDropdown.length > 0) {
            <select
              (change)="addTag($event)"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
              <option value="">Add a tag...</option>
              @for (tag of availableTagsForDropdown; track tag.id) {
                <option [value]="tag.id">{{ tag.name }}</option>
              }
            </select>
          } @else {
            <p class="text-gray-500 text-sm italic">
              @if (selectedTags.length === availableTags.length) {
                All available tags have been added
              } @else {
                No tags available
              }
            </p>
          }
        </div>

        <!-- Actions -->
        <div class="flex justify-end gap-3">
          <button
            type="button"
            (click)="onClose()"
            class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
          >
            Cancel
          </button>
          <button
            type="submit"
            [disabled]="noteForm.invalid"
            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
          >
            {{ isEditMode ? 'Save Changes' : 'Create Note' }}
          </button>
        </div>
      </form>
    </div>
  </div>
}
</file>

<file path="frontend/src/app/features/notes/components/note-form/note-form.component.spec.ts">
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { NoteFormComponent } from './note-form.component';

describe('NoteFormComponent', () => {
  let component: NoteFormComponent;
  let fixture: ComponentFixture<NoteFormComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [NoteFormComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(NoteFormComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});
</file>

<file path="frontend/src/app/features/notes/components/note-form/note-form.component.ts">
import { Component, Input, Output, EventEmitter, OnInit, OnChanges, SimpleChanges } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';
import { NoteResponse } from '../../models/note-response';
import { NoteRequest } from '../../models/note-request';
import { TagResponse } from '../../models/tag-response';
import { TagsService } from '../../services/tags.service';
import { NotesService } from '../../services/notes.service';

@Component({
  selector: 'app-note-form',
  imports: [CommonModule, ReactiveFormsModule],
  templateUrl: './note-form.component.html',
  styleUrl: './note-form.component.css'
})
export class NoteFormComponent implements OnInit, OnChanges {
  @Input() isOpen: boolean = false;
  @Input() note: NoteResponse | null = null;
  @Output() close = new EventEmitter<void>();
  @Output() save = new EventEmitter<{noteRequest: NoteRequest, tagIds: number[]}>();

  noteForm: FormGroup;
  isEditMode: boolean = false;
  availableTags: TagResponse[] = [];
  selectedTags: TagResponse[] = [];

  constructor(
    private fb: FormBuilder,
    private tagsService: TagsService,
    private notesService: NotesService
  ) {
    this.noteForm = this.fb.group({
      title: ['', [Validators.required, Validators.maxLength(255)]],
      content: ['', [Validators.required]]
    });
  }

  ngOnInit(): void {
    this.loadNoteData();
    this.loadAvailableTags();
  }

  ngOnChanges(changes: SimpleChanges): void {
    if (changes['note'] || changes['isOpen']) {
      this.loadNoteData();
    }
  }

  private loadNoteData(): void {
    if (this.note) {
      this.isEditMode = true;
      this.noteForm.patchValue({
        title: this.note.title,
        content: this.note.content
      });
      this.loadNoteTags();
    } else {
      this.isEditMode = false;
      this.selectedTags = [];
      this.noteForm.reset();
    }
  }

  private loadAvailableTags(): void {
    this.tagsService.getAll().subscribe({
      next: (tags) => {
        this.availableTags = tags;
      },
      error: (error) => {
        console.error('Error loading tags:', error);
      }
    });
  }

  private loadNoteTags(): void {
    if (this.note && this.note.id) {
      this.notesService.get(this.note.id).subscribe({
        next: (noteData) => {
          this.selectedTags = this.availableTags.filter(tag => 
            noteData.tags.includes(tag.name)
          );
        },
        error: (error) => {
          console.error('Error loading note tags:', error);
        }
      });
    }
  }

  onSubmit(): void {
    if (this.noteForm.valid) {
      const tagIds = this.selectedTags.map(tag => tag.id);
      this.save.emit({
        noteRequest: this.noteForm.value,
        tagIds: tagIds
      });
      this.onClose();
    }
  }

  onClose(): void {
    this.noteForm.reset();
    this.selectedTags = [];
    this.close.emit();
  }

  onBackdropClick(event: Event): void {
    if (event.target === event.currentTarget) {
      this.onClose();
    }
  }

  addTag(event: Event): void {
    const selectElement = event.target as HTMLSelectElement;
    const tagId = parseInt(selectElement.value);
    
    if (tagId) {
      const tag = this.availableTags.find(t => t.id === tagId);
      if (tag && !this.selectedTags.find(t => t.id === tag.id)) {
        this.selectedTags.push(tag);
      }
      selectElement.value = '';
    }
  }

  removeTag(tagId: number): void {
    this.selectedTags = this.selectedTags.filter(t => t.id !== tagId);
  }

  get availableTagsForDropdown(): TagResponse[] {
    return this.availableTags.filter(
      tag => !this.selectedTags.find(selected => selected.id === tag.id)
    );
  }
}
</file>

<file path="frontend/src/app/features/notes/models/note-request.ts">
export interface NoteRequest {
  title: string;
  content: string;
}
</file>

<file path="frontend/src/app/features/notes/models/note-response.ts">
export interface NoteResponse {
  id: number;
  title: string;
  content: string;
  tagsCount: number;
  tags: string[];
  createdAt: string;
  updatedAt: string;
}
</file>

<file path="frontend/src/app/features/notes/models/tag-request.ts">
export interface TagRequest {
  name: string;
}
</file>

<file path="frontend/src/app/features/notes/models/tag-response.ts">
export interface TagResponse {
  id: number;
  name: string;
  createdAt: string;
}
</file>

<file path="frontend/src/app/features/notes/pages/notes-list/notes-list.component.css">

</file>

<file path="frontend/src/app/features/notes/pages/notes-list/notes-list.component.html">
<div class="container mx-auto px-4 py-8 max-w-7xl">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-800">
        {{ showArchived ? 'Archived Notes' : 'My Notes' }}
      </h1>
      <p class="text-gray-600 mt-1">
        {{ notes.length }} {{ notes.length === 1 ? 'note' : 'notes' }}
      </p>
    </div>
    
    <div class="flex gap-3">
      <!-- Logout Button -->
      <button
        (click)="logout()"
        class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors flex items-center gap-2"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg>
        Logout
      </button>

      <!-- Button to toggle view -->
      <button
        (click)="toggleView()"
        class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors flex items-center gap-2"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
        </svg>
        {{ showArchived ? 'View Active Notes' : 'View Archived' }}
      </button>

      <!-- Button to go to tags -->
      <button
        (click)="router.navigate(['/tags'])"
        class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors flex items-center gap-2"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
        </svg>
        Go to Tags
      </button>

      <!-- Button to create note -->
      @if (!showArchived) {
        <button
          (click)="openCreateModal()"
          class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 shadow-md"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          New Note
        </button>
      }
    </div>
  </div>

  <!-- Filter by Tag -->
  <div class="mb-6">
    <label for="tagFilter" class="block text-sm font-semibold text-gray-700 mb-2">
      Filter by Tag
    </label>
    <select
      id="tagFilter"
      (change)="onFilterByTag($event)"
      [value]="selectedTagId || ''"
      class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
    >
      <option value="">All Tags</option>
      @for (tag of availableTags; track tag.id) {
        <option [value]="tag.id">{{ tag.name }}</option>
      }
    </select>
  </div>

  <!-- Loading -->
  @if (isLoading) {
    <div class="flex justify-center items-center py-20">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>
  }

  <!-- Lista de notas -->
  @if (!isLoading && notes.length > 0) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      @for (note of notes; track note.id) {
        <app-note-card
          [note]="note"
          [isArchived]="showArchived"
          (archive)="onArchive($event)"
          (unarchive)="onUnarchive($event)"
          (delete)="onDelete($event)"
          (edit)="openEditModal($event)"
        />
      }
    </div>
  }

  <!-- Empty state -->
  @if (!isLoading && notes.length === 0) {
    <div class="text-center py-20">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">
        {{ showArchived ? 'No archived notes' : 'No notes yet' }}
      </h3>
      <p class="text-gray-500 mb-6">
        {{ showArchived ? 'All your archived notes will appear here' : 'Start by creating your first note' }}
      </p>
      @if (!showArchived) {
        <button
          (click)="openCreateModal()"
          class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors inline-flex items-center gap-2"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          Create Note
        </button>
      }
    </div>
  }
</div>

<app-note-form
  [isOpen]="isModalOpen"
  [note]="selectedNote"
  (close)="closeModal()"
  (save)="onSaveNote($event)"
/>
</file>

<file path="frontend/src/app/features/notes/pages/notes-list/notes-list.component.spec.ts">
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { NotesListComponent } from './notes-list.component';

describe('NotesListComponent', () => {
  let component: NotesListComponent;
  let fixture: ComponentFixture<NotesListComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [NotesListComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(NotesListComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});
</file>

<file path="frontend/src/app/features/notes/pages/notes-list/notes-list.component.ts">
import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { Router } from '@angular/router';
import { NotesService } from '../../services/notes.service';
import { NoteResponse } from '../../models/note-response';
import { NoteRequest } from '../../models/note-request';
import { TagResponse } from '../../models/tag-response';
import { NoteCardComponent } from '../../components/note-card/note-card.component';
import { NoteFormComponent } from '../../components/note-form/note-form.component';
import { AuthService } from '../../../auth/services/auth.service';
import { TagsService } from '../../services/tags.service';

@Component({
  selector: 'app-notes-list',
  imports: [CommonModule, NoteCardComponent, NoteFormComponent],
  templateUrl: './notes-list.component.html',
  styleUrl: './notes-list.component.css'
})
export class NotesListComponent implements OnInit {
  notes: NoteResponse[] = [];
  showArchived: boolean = false;
  isLoading: boolean = false;
  isModalOpen: boolean = false;
  selectedNote: NoteResponse | null = null;
  availableTags: TagResponse[] = [];
  selectedTagId: number | null = null;

  constructor(
    private notesService: NotesService,
    public router: Router,
    private authService: AuthService,
    private tagsService: TagsService
  ) {}

  ngOnInit(): void {
    this.loadTags();
    this.loadNotes();
  }

  loadTags(): void {
    this.tagsService.getAll().subscribe({
      next: (tags) => {
        this.availableTags = tags;
      },
      error: (error) => {
        console.error('Error loading tags:', error);
      }
    });
  }

  loadNotes(): void {
    this.isLoading = true;
    const tagId = this.selectedTagId || undefined;
    const request$ = this.showArchived 
      ? this.notesService.getArchivedNotes(tagId)
      : this.notesService.getAll(tagId);

    request$.subscribe({
      next: (notes) => {
        this.notes = notes;
        this.isLoading = false;
      },
      error: (error) => {
        console.error('Error loading notes:', error);
        this.isLoading = false;
      }
    });
  }

  toggleView(): void {
    this.showArchived = !this.showArchived;
    this.loadNotes();
  }

  onFilterByTag(event: Event): void {
    const selectElement = event.target as HTMLSelectElement;
    const tagId = selectElement.value ? parseInt(selectElement.value) : null;
    this.selectedTagId = tagId;
    this.loadNotes();
  }

  onArchive(id: number): void {
    this.notesService.archiveNote(id).subscribe({
      next: () => {
        this.loadNotes();
      },
      error: (error) => {
        console.error('Error archiving note:', error);
      }
    });
  }

  onUnarchive(id: number): void {
    this.notesService.unarchiveNote(id).subscribe({
      next: () => {
        this.loadNotes();
      },
      error: (error) => {
        console.error('Error unarchiving note:', error);
      }
    });
  }

  onDelete(id: number): void {
    this.notesService.delete(id).subscribe({
      next: () => {
        this.loadNotes();
      },
      error: (error) => {
        console.error('Error deleting note:', error);
      }
    });
  }

  openCreateModal(): void {
    this.selectedNote = null;
    this.isModalOpen = true;
  }

  openEditModal(note: NoteResponse): void {
    this.selectedNote = note;
    this.isModalOpen = true;
  }

  closeModal(): void {
    this.isModalOpen = false;
    this.selectedNote = null;
  }

  onSaveNote(event: {noteRequest: NoteRequest, tagIds: number[]}): void {
    const { noteRequest, tagIds } = event;
    
    if (this.selectedNote) {
      this.notesService.update(this.selectedNote.id, noteRequest).subscribe({
        next: (updatedNote) => {
          this.updateNoteTags(updatedNote.id, tagIds);
        },
        error: (error) => {
          console.error('Error updating note:', error);
        }
      });
    } else {
      this.notesService.create(noteRequest).subscribe({
        next: (newNote) => {
          this.addTagsToNote(newNote.id, tagIds);
        },
        error: (error) => {
          console.error('Error creating note:', error);
        }
      });
    }
  }

  private addTagsToNote(noteId: number, tagIds: number[]): void {
    if (tagIds.length === 0) {
      this.loadNotes();
      this.closeModal();
      return;
    }

    let completed = 0;
    tagIds.forEach(tagId => {
      this.notesService.addTagToNote(noteId, tagId).subscribe({
        next: () => {
          completed++;
          if (completed === tagIds.length) {
            this.loadNotes();
            this.closeModal();
          }
        },
        error: (error) => {
          console.error('Error adding tag to note:', error);
          completed++;
          if (completed === tagIds.length) {
            this.loadNotes();
            this.closeModal();
          }
        }
      });
    });
  }

  private updateNoteTags(noteId: number, newTagIds: number[]): void {
    const currentNote = this.notes.find(n => n.id === noteId);
    if (!currentNote) {
      this.loadNotes();
      this.closeModal();
      return;
    }

    // Get all available tags to map names to IDs
    this.tagsService.getAll().subscribe({
      next: (availableTags) => {
        this.notesService.get(noteId).subscribe({
          next: (noteData) => {
           
            const currentTagIds = availableTags
              .filter((tag: TagResponse) => noteData.tags.includes(tag.name))
              .map((tag: TagResponse) => tag.id);

            
            const tagsToRemove = currentTagIds.filter((id: number) => !newTagIds.includes(id));
            const tagsToAdd = newTagIds.filter((id: number) => !currentTagIds.includes(id));

            // Count total operations
            const totalOperations = tagsToRemove.length + tagsToAdd.length;
            
            if (totalOperations === 0) {
              this.loadNotes();
              this.closeModal();
              return;
            }

            let completed = 0;
            const checkComplete = () => {
              completed++;
              if (completed === totalOperations) {
                this.loadNotes();
                this.closeModal();
              }
            };

            // Remove tags
            tagsToRemove.forEach((tagId: number) => {
              this.notesService.removeTagFromNote(noteId, tagId).subscribe({
                next: () => checkComplete(),
                error: (error) => {
                  console.error('Error removing tag from note:', error);
                  checkComplete();
                }
              });
            });

            // Add new tags
            tagsToAdd.forEach((tagId: number) => {
              this.notesService.addTagToNote(noteId, tagId).subscribe({
                next: () => checkComplete(),
                error: (error) => {
                  console.error('Error adding tag to note:', error);
                  checkComplete();
                }
              });
            });
          },
          error: (error) => {
            console.error('Error getting note details:', error);
            this.loadNotes();
            this.closeModal();
          }
        });
      },
      error: (error) => {
        console.error('Error loading tags:', error);
        this.loadNotes();
        this.closeModal();
      }
    });
  }

  logout(): void {
    this.authService.logout();
    this.router.navigate(['/auth/login']);
  }
}
</file>

<file path="frontend/src/app/features/notes/pages/tags-list/tags-list.component.css">

</file>

<file path="frontend/src/app/features/notes/pages/tags-list/tags-list.component.html">
<div class="container mx-auto px-4 py-8 max-w-6xl">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-800">Tag Management</h1>
      <p class="text-gray-600 mt-1">
        {{ tags.length }} {{ tags.length === 1 ? 'tag' : 'tags' }}
      </p>
    </div>
    
    <button
      (click)="router.navigate(['/notes'])"
      class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors flex items-center gap-2"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      Back to Notes
    </button>
  </div>

  <!-- Create Tag Form -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Create New Tag</h2>
    <form (ngSubmit)="onSubmit()" class="flex gap-3">
      <div class="flex-1">
        <input
          type="text"
          [(ngModel)]="newTagName"
          name="tagName"
          placeholder="Enter tag name..."
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          required
          maxlength="50"
        />
      </div>
      <button
        type="submit"
        [disabled]="!newTagName.trim() || isLoading"
        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center gap-2"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Add Tag
      </button>
    </form>
  </div>

  <!-- Loading -->
  @if (isLoading) {
    <div class="flex justify-center items-center py-20">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>
  }

  <!-- Tags Table -->
  @if (!isLoading && tags.length > 0) {
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              ID
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Tag Name
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Created At
            </th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for (tag of tags; track tag.id) {
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                #{{ tag.id }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                  </svg>
                  {{ tag.name }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ tag.createdAt | date:'dd/MM/yyyy HH:mm' }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button
                  (click)="confirmDelete(tag)"
                  class="text-red-600 hover:text-red-900 transition-colors inline-flex items-center gap-1"
                  title="Delete tag"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  Delete
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading && tags.length === 0) {
    <div class="bg-white rounded-lg shadow-md p-12 text-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
      </svg>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">No tags yet</h3>
      <p class="text-gray-500">Create your first tag to organize your notes</p>
    </div>
  }
</div>

<!-- Delete Confirmation Modal -->
@if (tagToDelete) {
  <div class="fixed inset-0 bg-white/30 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
      <div class="flex items-center gap-3 mb-4">
        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-gray-900">Delete Tag</h3>
          <p class="text-sm text-gray-500">This action cannot be undone</p>
        </div>
      </div>
      
      <p class="text-gray-700 mb-6">
        Are you sure you want to delete the tag <strong>"{{ tagToDelete.name }}"</strong>?
        This will remove the tag from all notes.
      </p>
      
      <div class="flex gap-3 justify-end">
        <button
          (click)="cancelDelete()"
          class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors"
        >
          Cancel
        </button>
        <button
          (click)="executeDelete()"
          class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors"
        >
          Delete Tag
        </button>
      </div>
    </div>
  </div>
}
</file>

<file path="frontend/src/app/features/notes/pages/tags-list/tags-list.component.spec.ts">
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { TagsListComponent } from './tags-list.component';

describe('TagsListComponent', () => {
  let component: TagsListComponent;
  let fixture: ComponentFixture<TagsListComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [TagsListComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(TagsListComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});
</file>

<file path="frontend/src/app/features/notes/pages/tags-list/tags-list.component.ts">
import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { Router } from '@angular/router';
import { TagsService } from '../../services/tags.service';
import { TagResponse } from '../../models/tag-response';
import { TagRequest } from '../../models/tag-request';

@Component({
  selector: 'app-tags-list',
  imports: [CommonModule, FormsModule],
  templateUrl: './tags-list.component.html',
  styleUrl: './tags-list.component.css'
})
export class TagsListComponent implements OnInit {
  isLoading: boolean = false;
  tags: TagResponse[] = [];
  newTagName: string = '';
  tagToDelete: TagResponse | null = null;

  constructor(
    private tagsService: TagsService,
    public router: Router
  ) {}

  ngOnInit(): void {
    this.loadTags();
  }

  loadTags(): void {
    this.isLoading = true;
    this.tagsService.getAll().subscribe({
      next: (tags) => {
        this.tags = tags;
        this.isLoading = false;
      },
      error: (error) => {
        console.error('Error loading tags:', error);
        this.isLoading = false;
      }
    });
  }

  onSubmit(): void {
    if (!this.newTagName.trim()) {
      return;
    }

    this.isLoading = true;
    const tagRequest: TagRequest = { name: this.newTagName.trim() };
    
    this.tagsService.create(tagRequest).subscribe({
      next: () => {
        this.newTagName = '';
        this.loadTags();
      },
      error: (error) => {
        console.error('Error creating tag:', error);
        this.isLoading = false;
      }
    });
  }

  confirmDelete(tag: TagResponse): void {
    this.tagToDelete = tag;
  }

  cancelDelete(): void {
    this.tagToDelete = null;
  }

  executeDelete(): void {
    if (!this.tagToDelete) {
      return;
    }

    this.tagsService.delete(this.tagToDelete.id).subscribe({
      next: () => {
        this.tagToDelete = null;
        this.loadTags();
      },
      error: (error) => {
        console.error('Error deleting tag:', error);
        this.tagToDelete = null;
        this.isLoading = false;
      }
    });
  }

  formatDate(dateString: string): string {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  }
}
</file>

<file path="frontend/src/app/features/notes/services/notes.service.ts">
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { NoteRequest } from '../models/note-request';
import { NoteResponse } from '../models/note-response';

@Injectable({
  providedIn: 'root'
})
export class NotesService {

  private api = 'http://localhost:8080/api/notes';

  constructor(private http: HttpClient) {}

  getAll(tagId?: number): Observable<NoteResponse[]> {
    if (tagId) {
      return this.http.get<NoteResponse[]>(this.api, { params: { tagId: tagId.toString() } });
    }
    return this.http.get<NoteResponse[]>(this.api);
  }

  getArchivedNotes(tagId?: number): Observable<NoteResponse[]> {
    if (tagId) {
      return this.http.get<NoteResponse[]>(`${this.api}/archived`, { params: { tagId: tagId.toString() } });
    }
    return this.http.get<NoteResponse[]>(`${this.api}/archived`);
  }

  get(id: number): Observable<NoteResponse> {
    return this.http.get<NoteResponse>(`${this.api}/${id}`);
  }

  create(request: NoteRequest): Observable<NoteResponse> {
    return this.http.post<NoteResponse>(this.api, request);
  }

  update(id: number, request: NoteRequest): Observable<NoteResponse> {
    return this.http.put<NoteResponse>(`${this.api}/${id}`, request);
  }

  archiveNote(id: number): Observable<NoteResponse> {
    return this.http.put<NoteResponse>(`${this.api}/${id}/archive`, {});
  }

  unarchiveNote(id: number): Observable<NoteResponse> {
    return this.http.put<NoteResponse>(`${this.api}/${id}/unarchive`, {});
  }

  delete(id: number): Observable<void> {
    return this.http.delete<void>(`${this.api}/${id}`);
  }

  addTagToNote(noteId: number, tagId: number): Observable<NoteResponse> {
    return this.http.post<NoteResponse>(`${this.api}/${noteId}/tags/${tagId}`, {});
  }

  removeTagFromNote(noteId: number, tagId: number): Observable<NoteResponse> {
    return this.http.delete<NoteResponse>(`${this.api}/${noteId}/tags/${tagId}`);
  }
}
</file>

<file path="frontend/src/app/features/notes/services/tags.service.ts">
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { TagRequest } from '../models/tag-request';
import { TagResponse } from '../models/tag-response';

@Injectable({
  providedIn: 'root'
})
export class TagsService {
  private api = 'http://localhost:8080/api/tags';

  constructor(private http: HttpClient) {}

  getAll(): Observable<TagResponse[]> {
    return this.http.get<TagResponse[]>(this.api);
  }

  create(request: TagRequest): Observable<TagResponse> {
    return this.http.post<TagResponse>(this.api, request);
  }

  delete(id: number): Observable<void> {
    return this.http.delete<void>(`${this.api}/${id}`);
  }
}
</file>

<file path="frontend/src/app/features/notes/notes.routes.ts">
import { Routes } from '@angular/router';
import { NotesListComponent } from './pages/notes-list/notes-list.component';
import { authGuard } from '../../core/guards/auth.guard';

export const NOTES_ROUTES: Routes = [
  { path: '', canActivate: [authGuard], component: NotesListComponent },
];
</file>

<file path="frontend/src/app/features/notes/tags.routes.ts">
import { Routes } from '@angular/router';
import { TagsListComponent } from './pages/tags-list/tags-list.component';
import { authGuard } from '../../core/guards/auth.guard';

export const TAGS_ROUTES: Routes = [
  { path: '', canActivate: [authGuard], component: TagsListComponent },
];
</file>

<file path="frontend/src/app/app.component.css">

</file>

<file path="frontend/src/app/app.component.html">
<router-outlet />
</file>

<file path="frontend/src/app/app.component.spec.ts">
import { TestBed } from '@angular/core/testing';
import { AppComponent } from './app.component';

describe('AppComponent', () => {
  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [AppComponent],
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

  it(`should have the 'frontend' title`, () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app.title).toEqual('frontend');
  });

  it('should render title', () => {
    const fixture = TestBed.createComponent(AppComponent);
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('h1')?.textContent).toContain('Hello, frontend');
  });
});
</file>

<file path="frontend/src/app/app.component.ts">
import { Component } from '@angular/core';
import { RouterOutlet } from '@angular/router';

@Component({
  selector: 'app-root',
  imports: [RouterOutlet],
  templateUrl: './app.component.html',
  styleUrl: './app.component.css'
})
export class AppComponent {
  title = 'frontend';
}
</file>

<file path="frontend/src/app/app.config.ts">
import { ApplicationConfig, provideZoneChangeDetection } from '@angular/core';
import { provideRouter } from '@angular/router';
import { provideHttpClient, withInterceptors } from '@angular/common/http';
import { provideAnimations } from '@angular/platform-browser/animations';
import { provideToastr } from 'ngx-toastr';

import { routes } from './app.routes';
import { authInterceptor } from './core/interceptors/auth.interceptor';

export const appConfig: ApplicationConfig = {
  providers: [
    provideZoneChangeDetection({ eventCoalescing: true }),
    provideRouter(routes),
    provideHttpClient(withInterceptors([authInterceptor])),
    provideAnimations(),
    provideToastr({
      positionClass: 'toast-top-right',
      timeOut: 3000,
      preventDuplicates: true,
      progressBar: true
    })
  ]
};
</file>

<file path="frontend/src/app/app.routes.ts">
import { Routes } from '@angular/router';

export const routes: Routes = [
  {
    path: 'auth',
    loadChildren: () =>
      import('./features/auth/auth.routes').then(m => m.AUTH_ROUTES)
  },
  {
    path: 'notes',
    loadChildren: () =>
      import('./features/notes/notes.routes').then(m => m.NOTES_ROUTES)
  },
  {
    path: 'tags',
    loadChildren: () =>
      import('./features/notes/tags.routes').then(m => m.TAGS_ROUTES)
  },
  {
    path: '',
    redirectTo: '/auth/login',
    pathMatch: 'full'
  }
];
</file>

<file path="frontend/src/index.html">
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Notes App</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <app-root></app-root>
</body>
</html>
</file>

<file path="frontend/src/main.ts">
import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { AppComponent } from './app/app.component';

bootstrapApplication(AppComponent, appConfig)
  .catch((err) => console.error(err));
</file>

<file path="frontend/src/styles.css">
/* You can add global styles to this file, and also import other style files */
@import 'ngx-toastr/toastr';
</file>

<file path="frontend/.editorconfig">
# Editor configuration, see https://editorconfig.org
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
insert_final_newline = true
trim_trailing_whitespace = true

[*.ts]
quote_type = single
ij_typescript_use_double_quotes = false

[*.md]
max_line_length = off
trim_trailing_whitespace = false
</file>

<file path="frontend/.gitignore">
# See https://docs.github.com/get-started/getting-started-with-git/ignoring-files for more about ignoring files.

# Compiled output
/dist
/tmp
/out-tsc
/bazel-out

# Node
/node_modules
npm-debug.log
yarn-error.log

# IDEs and editors
.idea/
.project
.classpath
.c9/
*.launch
.settings/
*.sublime-workspace

# Visual Studio Code
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
.history/*

# Miscellaneous
/.angular/cache
.sass-cache/
/connect.lock
/coverage
/libpeerconnection.log
testem.log
/typings

# System files
.DS_Store
Thumbs.db
</file>

<file path="frontend/angular.json">
{
  "$schema": "./node_modules/@angular/cli/lib/config/schema.json",
  "version": 1,
  "newProjectRoot": "projects",
  "projects": {
    "frontend": {
      "projectType": "application",
      "schematics": {},
      "root": "",
      "sourceRoot": "src",
      "prefix": "app",
      "architect": {
        "build": {
          "builder": "@angular-devkit/build-angular:application",
          "options": {
            "outputPath": "dist/frontend",
            "index": "src/index.html",
            "browser": "src/main.ts",
            "polyfills": [
              "zone.js"
            ],
            "tsConfig": "tsconfig.app.json",
            "assets": [
              {
                "glob": "**/*",
                "input": "public"
              }
            ],
            "styles": [
              "src/styles.css"
            ],
            "scripts": []
          },
          "configurations": {
            "production": {
              "budgets": [
                {
                  "type": "initial",
                  "maximumWarning": "500kB",
                  "maximumError": "1MB"
                },
                {
                  "type": "anyComponentStyle",
                  "maximumWarning": "4kB",
                  "maximumError": "8kB"
                }
              ],
              "outputHashing": "all"
            },
            "development": {
              "optimization": false,
              "extractLicenses": false,
              "sourceMap": true
            }
          },
          "defaultConfiguration": "production"
        },
        "serve": {
          "builder": "@angular-devkit/build-angular:dev-server",
          "configurations": {
            "production": {
              "buildTarget": "frontend:build:production"
            },
            "development": {
              "buildTarget": "frontend:build:development"
            }
          },
          "defaultConfiguration": "development"
        },
        "extract-i18n": {
          "builder": "@angular-devkit/build-angular:extract-i18n"
        },
        "test": {
          "builder": "@angular-devkit/build-angular:karma",
          "options": {
            "polyfills": [
              "zone.js",
              "zone.js/testing"
            ],
            "tsConfig": "tsconfig.spec.json",
            "assets": [
              {
                "glob": "**/*",
                "input": "public"
              }
            ],
            "styles": [
              "src/styles.css"
            ],
            "scripts": []
          }
        }
      }
    }
  }
}
</file>

<file path="frontend/package.json">
{
  "name": "frontend",
  "version": "0.0.0",
  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build",
    "watch": "ng build --watch --configuration development",
    "test": "ng test"
  },
  "private": true,
  "dependencies": {
    "@angular/animations": "^19.2.15",
    "@angular/common": "^19.2.0",
    "@angular/compiler": "^19.2.0",
    "@angular/core": "^19.2.0",
    "@angular/forms": "^19.2.0",
    "@angular/platform-browser": "^19.2.0",
    "@angular/platform-browser-dynamic": "^19.2.0",
    "@angular/router": "^19.2.0",
    "ngx-toastr": "^19.1.0",
    "rxjs": "~7.8.0",
    "sweetalert2": "^11.26.3",
    "tslib": "^2.3.0",
    "zone.js": "~0.15.0"
  },
  "devDependencies": {
    "@angular-devkit/build-angular": "^19.2.13",
    "@angular/cli": "^19.2.13",
    "@angular/compiler-cli": "^19.2.0",
    "@types/jasmine": "~5.1.0",
    "jasmine-core": "~5.6.0",
    "karma": "~6.4.0",
    "karma-chrome-launcher": "~3.2.0",
    "karma-coverage": "~2.2.0",
    "karma-jasmine": "~5.1.0",
    "karma-jasmine-html-reporter": "~2.1.0",
    "typescript": "~5.7.2"
  }
}
</file>

<file path="frontend/README.md">
# Frontend

This project was generated using [Angular CLI](https://github.com/angular/angular-cli) version 19.2.13.

## Development server

To start a local development server, run:

```bash
ng serve
```

Once the server is running, open your browser and navigate to `http://localhost:4200/`. The application will automatically reload whenever you modify any of the source files.

## Code scaffolding

Angular CLI includes powerful code scaffolding tools. To generate a new component, run:

```bash
ng generate component component-name
```

For a complete list of available schematics (such as `components`, `directives`, or `pipes`), run:

```bash
ng generate --help
```

## Building

To build the project run:

```bash
ng build
```

This will compile your project and store the build artifacts in the `dist/` directory. By default, the production build optimizes your application for performance and speed.

## Running unit tests

To execute unit tests with the [Karma](https://karma-runner.github.io) test runner, use the following command:

```bash
ng test
```

## Running end-to-end tests

For end-to-end (e2e) testing, run:

```bash
ng e2e
```

Angular CLI does not come with an end-to-end testing framework by default. You can choose one that suits your needs.

## Additional Resources

For more information on using the Angular CLI, including detailed command references, visit the [Angular CLI Overview and Command Reference](https://angular.dev/tools/cli) page.
</file>

<file path="frontend/tsconfig.app.json">
/* To learn more about Typescript configuration file: https://www.typescriptlang.org/docs/handbook/tsconfig-json.html. */
/* To learn more about Angular compiler options: https://angular.dev/reference/configs/angular-compiler-options. */
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/app",
    "types": []
  },
  "files": [
    "src/main.ts"
  ],
  "include": [
    "src/**/*.d.ts"
  ]
}
</file>

<file path="frontend/tsconfig.json">
/* To learn more about Typescript configuration file: https://www.typescriptlang.org/docs/handbook/tsconfig-json.html. */
/* To learn more about Angular compiler options: https://angular.dev/reference/configs/angular-compiler-options. */
{
  "compileOnSave": false,
  "compilerOptions": {
    "outDir": "./dist/out-tsc",
    "strict": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "skipLibCheck": true,
    "isolatedModules": true,
    "esModuleInterop": true,
    "experimentalDecorators": true,
    "moduleResolution": "bundler",
    "importHelpers": true,
    "target": "ES2022",
    "module": "ES2022"
  },
  "angularCompilerOptions": {
    "enableI18nLegacyMessageIdFormat": false,
    "strictInjectionParameters": true,
    "strictInputAccessModifiers": true,
    "strictTemplates": true
  }
}
</file>

<file path="frontend/tsconfig.spec.json">
/* To learn more about Typescript configuration file: https://www.typescriptlang.org/docs/handbook/tsconfig-json.html. */
/* To learn more about Angular compiler options: https://angular.dev/reference/configs/angular-compiler-options. */
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/spec",
    "types": [
      "jasmine"
    ]
  },
  "include": [
    "src/**/*.spec.ts",
    "src/**/*.d.ts"
  ]
}
</file>

<file path="CHALLENGE.md">
# Full Stack Implementation Exercise

## 1. Requirements / Intro

You need to implement a simple web application that allows you to take notes, tag, and filter them. The development is divided into two phases:

- **Phase 1**: Note creation
- **Phase 2**: Tag application and filtering

### IMPORTANT CONSIDERATIONS:

- Phase 1 is mandatory to pass this exercise, while Phase 2 will provide extra points if done.
- Content should be persisted in a relational database by using an ORM - in-memory storage or mocks are not allowed.

## 2. Deliverables

To pass this exercise, in addition to the implementation, you must:

- Upload the code to a private GitHub repository given by Ensolvers HR staff and use git properly. Both the frontend and the backend should be pushed to that repository, in folders named `backend` and `frontend` respectively.
- Include a bash/zsh script allowing to run the app. Ideally, the app should start in a Linux/macOS environment just by running one command. This command should set up everything that is required to run the app, like setting up a DB schema, pre-creating any config file, etc.
- Include a `README.md` file describing all the runtimes, engines, tools, etc., required to run the app, with their concrete versions (e.g., npm 18.17, etc).

## 3. Technologies

There is no restriction about the technology to be used, provided that:

- Structure the app as a Single Page Web Application (SPA), i.e., frontend and backend are different apps. This is the general case when you use React, Angular, Vue.js, or any other similar UI framework. Please consider that rendering a web page on the server-side (by using JSP, EJS, Smarty, Blade, etc.) but using a bit of JS to, for instance, fetch some data, is not a pure SPA. You need to implement an isolated app, in a separate folder, with its custom package.json and dependencies.
- The backend app exposes a REST API for communication with the frontend.
- The backend app is separated into layers (e.g., Controllers, Services, DAOs/Repositories). It is important to mention that Laravel (PHP) and Django (Python) DO NOT SUPPORT that layer separation by default when building apps, so if you submit a backend done directly with those technologies without any further adjustment in the architecture, it might probably need to be improved or the exercise will be rejected directly. On the other hand, Spring Boot (Java) and Nestjs (Node.js) are two technologies that enforce and/or ease the use of this layer separation. For more information, you can check the definition of the [Service Layer](https://martinfowler.com/eaaCatalog/serviceLayer.html) pattern and an [example](https://www.sourcecodeexamples.net/2021/08/spring-boot-project-with-controller.html) in Spring Boot

## 4. User Stories and Mockups

### Phase 1

#### User Stories

- As a user, I want to be able to create, edit, and delete notes.
- As a user, I want to archive/unarchive notes.
- As a user, I want to list my active notes.
- As a user, I want to list my archived notes.

### Phase 2

#### User Stories

- As a user, I want to be able to add/remove categories to notes.
- As a user, I want to be able to filter notes by category.

## 5. Extra Functional and Non-Functional Requirements

- **Login**: If you provide a login screen, document the default user/password in `README.md`.
- **Live deployed version**: If you deploy the app (e.g., via Heroku), add the URL of the live running version to `README.md`.
</file>

<file path="Readme.md">
##  Notes Application - Full Stack

![Java](https://img.shields.io/badge/Java-21-ED8B00?style=for-the-badge&logo=openjdk&logoColor=white)
![Spring Boot](https://img.shields.io/badge/Spring_Boot-3.5.8-6DB33F?style=for-the-badge&logo=spring-boot&logoColor=white)
![Angular](https://img.shields.io/badge/Angular-19.2-DD0031?style=for-the-badge&logo=angular&logoColor=white)
![MySQL](https://img.shields.io/badge/MySQL-8-4479A1?style=for-the-badge&logo=mysql&logoColor=white)
![TypeScript](https://img.shields.io/badge/TypeScript-5.7-3178C6?style=for-the-badge&logo=typescript&logoColor=white)

Full stack web application for notes management with authentication system, categories and advanced filters.

##  Testing URLs

- **API Backend:** [https://api.ezer.pe](https://api.ezer.pe)
- **Frontend Web:** [https://notas.ezer.pe](https://notas.ezer.pe)

---

##  Table of Contents

- [ Features](#-features)
- [ Architecture](#-architecture)
- [ Backend](#-backend)
- [ Frontend](#-frontend)
- [ Prerequisites](#-prerequisites)
- [ Installation and Execution](#-installation-and-execution)
- [ Access Credentials](#-access-credentials)
- [ Project Structure](#-project-structure)

---

##  Features

###  Phase 1 (Completed)
-  Create, edit and delete notes
-  Archive/unarchive notes
-  List active notes
-  List archived notes
-  Authentication system with JWT

###  Phase 2 (Complete)
-  Add/remove categories to notes
-  Filter notes by category
-  Intuitive and responsive interface

---

##  Arquitectura

This project implements a **Single Page Application (SPA)** architecture with complete separation between frontend and backend:

```
         REST API          
                                    
   Angular 19          JSON / JWT            Spring Boot    
   (Frontend)                                 (Backend)     
                                                            
                          
                                                      
                                                       JPA/Hibernate
                                                      
                                              
                                                 MySQL 8.x     
                                                 (Database)    
                                              
```

---

##  Backend

###  Technology Stack

| Technology | Version | Description |
|-----------|---------|-------------|
| **Java** | 21 | Programming language |
| **Spring Boot** | 3.5.8-SNAPSHOT | Main framework |
| **Spring Data JPA** | 3.5.x | Data persistence |
| **Spring Security** | 6.x | Security and authentication |
| **MySQL Connector** | Latest | Database driver |
| **Lombok** | Latest | Boilerplate code reduction |
| **JWT (JJWT)** | 0.12.5 | Token-based authentication |
| **Maven** | 3.x | Dependency manager |

###  Backend Architecture

The backend follows the **layered architecture** pattern:
```
 pe.ezer.backend
   config/                # Configuration classes
    security/           # Security configuration (JWT, Auth filters)
    seeder/             # Database seeders (Initial data)
   modules/               # Business logic modules
    note/               # Note management module
     domain/           # Entity models
     mapper/           # DTO-Entity mappers
     repo/             # Repository interfaces (Data access)
     service/          # Business logic services
     web/              # REST controllers
       dto/            # Data Transfer Objects
    user/               # User management module
      domain/           # Entity models
      mapper/           # DTO-Entity mappers
      repo/             # Repository interfaces (Data access)
      service/          # Business logic services
      web/              # REST controllers
        dto/            # Data Transfer Objects
   shared/                # Shared utilities and exceptions
```

###  Main Dependencies

#### Core Spring Boot
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>
```

#### JWT Security
```xml
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.12.5</version>
</dependency>
```

#### Database
```xml
<dependency>
    <groupId>com.mysql</groupId>
    <artifactId>mysql-connector-j</artifactId>
</dependency>
```

###  Configuration

**Server port:** `8080`  
**Database:** `vidarte_db` (MySQL)  
**Connection URL:** `jdbc:mysql://localhost:3306/vidarte_db`

---

##  Frontend

###  Technology Stack

| Technology | Version | Description |
|-----------|---------|-------------|
| **Angular** | 19.2.0 | Main framework |
| **TypeScript** | 5.7.2 | Programming language |
| **RxJS** | 7.8.0 | Reactive programming |
| **Angular Router** | 19.2.0 | SPA navigation |
| **Angular Forms** | 19.2.0 | Form handling |
| **NGX Toastr** | 19.1.0 | Toast notifications |
| **SweetAlert2** | 11.26.3 | Custom alerts |
| **Node.js** | 18+ | JavaScript runtime |
| **npm** | 9+ | Package manager |

###  Frontend Architecture

The frontend follows the **modular architecture** pattern with **Standalone Components**:

```
 src/app
   core/                  # Core functionalities
    interceptors/       # HTTP interceptors (Auth)
    guards/       # Guards
   features/              # Feature modules
    auth/               # Authentication
     pages/
     services/
     models/
     auth.routes.ts
    notes/              # Notes management
      pages/
      components/
      services/
      models/
      notes.routes.ts
      tags.routes.ts
   shared/                # Shared components
   app.config.ts         # App configuration
   app.routes.ts         # Main routes
```

###  Main Features

####  Authentication System
- Login with JWT
- HTTP interceptor for automatic authentication
- Route guards
- Token management in localStorage

####  Notes Management
- `note-card` component for visualization
- `note-form` component for create/edit
- Notes service with REST communication
- TypeScript typed models

####  UI/UX
- Notifications with **NGX Toastr**
- Responsive design
- Reactive forms

###  Main Dependencies

```json
{
  "@angular/core": "^19.2.0",
  "@angular/common": "^19.2.0",
  "@angular/forms": "^19.2.0",
  "@angular/router": "^19.2.0",
  "ngx-toastr": "^19.1.0",
  "rxjs": "~7.8.0"
}
```

---

##  Prerequisites

Make sure you have the following tools installed with their specific versions:

###  Required Software

| Tool | Minimum Version | Verify Installation |
|-------------|----------------|----------------------|
| **Java JDK** | 21 | `java -version` |
| **Maven** | 3.8+ | `mvn -version` |
| **Node.js** | 18+ | `node -v` |
| **npm** | 9+ | `npm -v` |
| **MySQL** | 8.0+ | `mysql --version` |
| **Angular CLI** | 19+ | `ng version` |

###  Tools Installation

#### Java 21
```bash
# Windows: Download from https://adoptium.net/
# Linux/Mac:
sdk install java 21-tem
```

#### Node.js and npm
```bash
# Download from https://nodejs.org/
# Or use nvm:
nvm install 18
nvm use 18
```

#### Angular CLI
```bash
npm install -g @angular/cli@19
```

#### MySQL
```bash
# Windows: Download from https://dev.mysql.com/downloads/installer/
# Linux:
sudo apt-get install mysql-server
# Mac:
brew install mysql
```

---

##  Installation and Execution

### 1 Clone the Repository

```bash
git clone <repository-url>
cd VidarteTicliahuanca-2509af
```

### 2 Configure the Database

```sql
-- Create the database
CREATE DATABASE vidarte_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Create user (optional)
CREATE USER 'vidarte_user'@'localhost' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON vidarte_db.* TO 'vidarte_user'@'localhost';
FLUSH PRIVILEGES;
```

**Note:** If you use different user/password, update `backend/src/main/resources/application.properties`

### 3 Run the Backend

```bash
cd backend

# Compile the project
mvn clean install

# Run the application
mvn spring-boot:run
```

The backend will be available at: **http://localhost:8080**

### 4 Run the Frontend

```bash
cd frontend

# Install dependencies
npm install

# Run in development mode
npm start
```

The frontend will be available at: **http://localhost:4200**

### 5 Access the Application

Open your browser and visit: **http://localhost:4200**

---

##  Access Credentials

###  Test User

The system includes a seeder that automatically creates test users:

| Field | Value |
|-------|-------|
| **User** | `admin` |
| **Password** | `admin123` |

> **Note:** The exact credentials are automatically generated when starting the backend for the first time. Check the application logs to get the default credentials.

---

##  Project Structure

```
VidarteTicliahuanca-2509af/
  backend/                    # Spring Boot application
   src/
    main/
     java/
      pe/ezer/backend/
        BackendApplication.java
        config/         # Configurations (Security, CORS)
        modules/        # Business modules
         user/
         note/
        shared/         # Shared utilities
     resources/
       application.properties
    test/
   pom.xml                  # Maven configuration
   mvnw                     # Maven Wrapper (Linux/Mac)
   mvnw.cmd                 # Maven Wrapper (Windows)

  frontend/                   # Angular application
   src/
    app/
     core/               # Core functionalities
     features/           # Feature modules
      auth/            # Authentication
      notes/           # Notes management
     shared/             # Shared components
     app.config.ts
     app.routes.ts
     app.component.ts
    index.html
    main.ts
    styles.css
   package.json             # npm dependencies
   angular.json             # Angular configuration
   tsconfig.json            # TypeScript configuration

  README.md                   # This file
  CHALLENGE.md                # Challenge description
```

---

##  API Endpoints

###  Authentication

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/auth/login` | User login |

###  Notes

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/notes` | List all notes |
| GET | `/api/notes/{id}` | Get a note |
| POST | `/api/notes` | Create new note |
| PUT | `/api/notes/{id}` | Update note |
| DELETE | `/api/notes/{id}` | Delete note |
| PATCH | `/api/notes/{id}/archive` | Archive note |
| PATCH | `/api/notes/{id}/unarchive` | Unarchive note |
| POST | `/api/notes/{noteId}/tags/{tagId}` | Add tag to note |
| DELETE | `/api/notes/{noteId}/tags/{tagId}` | Remove tag from note |

---

##  Available Scripts

### Backend
```bash
mvn clean          # Clean build
mvn install        # Install dependencies
mvn spring-boot:run # Run application
mvn test           # Run tests
```

### Frontend
```bash
npm start          # Run in development mode
npm run build      # Build for production
npm test           # Run tests
npm run watch      # Build and watch changes
```

---

##  Additional Notes

###  Security
- JWT-based authentication
- BCrypt encrypted passwords
- CORS configured for development
- Spring Security with custom filters

###  Database
- Hibernate with `update` strategy
- MySQL 8 dialect
- SQL format enabled for debugging

###  Styles
- CSS with Tailwind
- Responsive design
- Angular standalone components

---

##  Developed by

**Vidarte Ticliahuanca**

---

##  License

This project was developed as part of a technical exercise.

---

** Happy Coding!**
</file>

<file path="run.ps1">
#!/usr/bin/env pwsh

Write-Host "Installing frontend dependencies..." -ForegroundColor Cyan
Set-Location frontend
npm install

if ($LASTEXITCODE -ne 0) {
    Write-Host "npm install failed!" -ForegroundColor Red
    exit 1
}

Write-Host "Building backend..." -ForegroundColor Green
Set-Location ../backend
mvn clean package

if ($LASTEXITCODE -ne 0) {
    Write-Host "Backend build failed!" -ForegroundColor Red
    exit 1
}

Write-Host "Starting backend server in background..." -ForegroundColor Green

# Find the JAR file
$jarFile = Get-ChildItem -Path "target" -Filter "*.jar" -Exclude "*-sources.jar","*-javadoc.jar" | Select-Object -First 1

if (-not $jarFile) {
    Write-Host "No JAR file found in target directory!" -ForegroundColor Red
    exit 1
}

# Start backend in a new process
$backendJob = Start-Process -FilePath "java" -ArgumentList "-jar", $jarFile.FullName -PassThru -NoNewWindow

# Wait a few seconds for backend to start
Start-Sleep -Seconds 5

Write-Host "Backend server started (PID: $($backendJob.Id))" -ForegroundColor Green
Write-Host "Starting frontend server..." -ForegroundColor Green

# Return to root directory and navigate to frontend
Set-Location ../frontend

# Run Angular development server
ng serve

# Cleanup: Stop backend when frontend stops
if ($backendJob -and !$backendJob.HasExited) {
    Write-Host "Stopping backend server..." -ForegroundColor Yellow
    Stop-Process -Id $backendJob.Id -Force
}
</file>

<file path="run.sh">
#!/bin/bash

echo "Installing frontend dependencies..."
cd frontend
npm install

echo "Building backend..."
cd ../backend
mvn clean package

echo "Starting backend server in background..."
# Create a screen session to run the JAR in the background
screen -dmS backend-service bash -c "java -jar target/*.jar"

echo "Starting frontend development server..."
# Return to root directory and navigate to frontend
cd ../frontend

# Run Angular development server
ng serve
</file>

</files>
